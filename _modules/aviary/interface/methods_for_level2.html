
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>aviary.interface.methods_for_level2</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=9c3e77be" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=e4d2302c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=1ae7504c"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/aviary/interface/methods_for_level2';</script>
    <link rel="icon" href="../../../_static/aviary_logo.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/aviary.png" class="logo__image only-light" alt=" - Home"/>
    <script>document.write(`<img src="../../../_static/aviary.png" class="logo__image only-dark" alt=" - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../intro.html">
                    Aviary Documentation
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/installation.html">Installation</a></li>





<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/what_aviary_does.html">What Aviary Does</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/tools_that_aviary_uses.html">Tools That Aviary is Built Upon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/expected_user_knowledge.html">Expected User Knowledge</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../getting_started/onboarding.html">Onboarding Guide</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../getting_started/onboarding_level1.html">Level 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting_started/onboarding_level2.html">Level 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting_started/onboarding_level3.html">Level 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting_started/onboarding_ext_subsystem.html">Models with External Subsystems</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../../getting_started/input_csv_phase_info.html">Vehicle Input .csv File and Phase_info Dictionary</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/now_what.html">Now What?</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../user_guide/user_interface.html">Aviary User Interface</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/UI_Levels.html">User Interface Levels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/examples_of_the_same_mission_at_different_UI_levels.html">Examples of the same mission at different UI levels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/aviary_commands.html">Command Line Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/input_files.html">Input Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/phase_info.html">The <code class="docutils literal notranslate"><span class="pre">phase_info</span></code> Format</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/phase_info_detailed.html">Complete <code class="docutils literal notranslate"><span class="pre">phase_info</span></code> user options reference for all Aviary EquationsOfMotion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/phase_info_conversion.html">Converting from legacy <code class="docutils literal notranslate"><span class="pre">phase_info</span></code> user options</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_guide/drawing_and_running_simple_missions.html">Drawing and running simple missions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_guide/pre_mission_and_mission.html">Pre-Mission and Mission</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_guide/postprocessing_and_visualizing_results.html">Postprocessing and Visualizing Results from Aviary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_guide/variable_metadata.html">Understanding the Variable Metadata</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../user_guide/features_and_functionalities.html">Features and Functionalities</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/aerodynamics.html">Aerodynamics Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/external_aero.html">Externally Computed Polars</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/atmosphere.html">Atmosphere Subsystem</a></li>







<li class="toctree-l2 has-children"><a class="reference internal" href="../../../user_guide/propulsion.html">Propulsion</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user_guide/creating_a_turboprop_engine.html">Creating a Turboprop Powered Aircraft Example</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/hamilton_standard.html">Hamilton Standard Propulsion Model</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/mass.html">Mass Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/subsystems.html">SubsystemBuilder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/using_external_subsystems.html">Using external subsystems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/step_by_step_external_guide.html">Step-by-step guide for creating, testing, and using external subsystems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/battery_subsystem_example.html">In-depth look at the battery subsystem as an example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/features/overriding.html">Overriding Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/FLOPS_based_detailed_takeoff_and_landing.html">FLOPS Based Detailed Takeoff and Landing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/reserve_missions.html">Reserve Mission</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/multi_mission.html">Multi-Mission Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/off_design_missions.html">Off-Design Missions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/payload_range_functionality.html">Payload Range Functionality.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/features/blended_wing_body_GASP.html">GASP Based Blended Wing Body Modeling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user_guide/features/blended_wing_body_FLOPS.html">FLOPS Based Blended Wing Body Modeling</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_guide/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../examples/intro.html">Discussing the Aviary Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/simple_mission_example.html">Conventional Aircraft and Simple Mission</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/more_advanced_example.html">Optimizing the Mission Profile of a Conventional Aircraft</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/coupled_aircraft_mission_optimization.html">Coupled Aircraft-Mission Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/additional_flight_phases.html">Mission Optimization with Many Phases for a Commercial Aircraft</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/reserve_missions.html">Reserve Mission Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/multi_mission.html">Multi-Mission Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/off_design_example.html">Off-Design Mission Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/OAS_subsystem.html">Using Aviary and OpenAeroStruct Together</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/level_2_detailed_takeoff_and_landing.html">Level 2 Detailed Takeoff and Landing</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Theory Guide</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../theory_guide/intro.html">Overview of Aviary Functionality</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../theory_guide/underlying_concepts.html">Underlying Concepts</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../theory_guide/assumptions.html">Assumptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../theory_guide/aerodynamics.html">Core Aerodynamics Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../theory_guide/geometry.html">Core Geometry Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../theory_guide/mass.html">Core Mass Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../theory_guide/mission.html">Mission Analysis</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../theory_guide/propulsion.html">Core Propulsion Subsystem</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../theory_guide/turboprop.html">The Turboprop Model</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../../theory_guide/optimization_algorithms.html">Optimization Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../theory_guide/validation.html">Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../theory_guide/gasp_based_bwb.html">GASP based BWB model implementation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide/codebase_overview.html">Codebase Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide/coding_standards.html">Coding Standards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide/ai_policy.html">Aviaryâ€™s AI Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide/unit_tests.html">Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide/contributing_guidelines.html">Guidelines for Contributing Code</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../developer_guide/how_to_contribute_docs.html">How to Contribute Docs</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../developer_guide/doctape.html">DocTAPE</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../developer_guide/doctape_examples.html">DocTAPE Examples</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide/debugging_env_from_github.html">Using Dev Environments from GitHub Actions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Miscellaneous Resources</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../misc_resources/modeling_exercise.html">Modeling Exercise for the Usability Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc_resources/FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc_resources/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc_resources/resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc_resources/externally_supported_subsystems.html">Externally Supported Subsystems</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../misc_resources/feature_comparison.html">Feature Comparison with Legacy Codes</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../misc_resources/comparison_to_flops.html">Comparison to FLOPS</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc_resources/planned_future_features.html">Planned Future Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_srcdocs/index.html">Source Docs</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/openmdao/Aviary" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/openmdao/Aviary/issues/new?title=Issue%20on%20page%20%2F_modules/aviary/interface/methods_for_level2.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for aviary.interface.methods_for_level2</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">csv</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">copy</span><span class="w"> </span><span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">dymos</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">dm</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">openmdao</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">openmdao.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">om</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openmdao.utils.reports_system</span><span class="w"> </span><span class="kn">import</span> <span class="n">_default_reports</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openmdao.utils.units</span><span class="w"> </span><span class="kn">import</span> <span class="n">convert_units</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">packaging</span><span class="w"> </span><span class="kn">import</span> <span class="n">version</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">aviary.core.aviary_group</span><span class="w"> </span><span class="kn">import</span> <span class="n">AviaryGroup</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aviary.interface.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">set_warning_format</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aviary.utils.aviary_values</span><span class="w"> </span><span class="kn">import</span> <span class="n">AviaryValues</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aviary.utils.csv_data_file</span><span class="w"> </span><span class="kn">import</span> <span class="n">write_data_file</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aviary.utils.functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">convert_strings_to_data</span><span class="p">,</span> <span class="n">get_path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aviary.utils.merge_variable_metadata</span><span class="w"> </span><span class="kn">import</span> <span class="n">merge_meta_data</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aviary.utils.named_values</span><span class="w"> </span><span class="kn">import</span> <span class="n">NamedValues</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aviary.variable_info.enums</span><span class="w"> </span><span class="kn">import</span> <span class="n">EquationsOfMotion</span><span class="p">,</span> <span class="n">LegacyCode</span><span class="p">,</span> <span class="n">ProblemType</span><span class="p">,</span> <span class="n">Verbosity</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aviary.variable_info.functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">setup_model_options</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aviary.variable_info.variable_meta_data</span><span class="w"> </span><span class="kn">import</span> <span class="n">_MetaData</span> <span class="k">as</span> <span class="n">BaseMetaData</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aviary.variable_info.variables</span><span class="w"> </span><span class="kn">import</span> <span class="n">Aircraft</span><span class="p">,</span> <span class="n">Dynamic</span><span class="p">,</span> <span class="n">Mission</span><span class="p">,</span> <span class="n">Settings</span>

<span class="n">FLOPS</span> <span class="o">=</span> <span class="n">LegacyCode</span><span class="o">.</span><span class="n">FLOPS</span>
<span class="n">GASP</span> <span class="o">=</span> <span class="n">LegacyCode</span><span class="o">.</span><span class="n">GASP</span>


<div class="viewcode-block" id="AviaryProblem">
<a class="viewcode-back" href="../../../_srcdocs/packages/interface/methods_for_level2.html#aviary.interface.methods_for_level2.AviaryProblem">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">AviaryProblem</span><span class="p">(</span><span class="n">om</span><span class="o">.</span><span class="n">Problem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main class for instantiating, formulating, and solving Aviary problems.</span>

<span class="sd">    On a basic level, this problem object is all the conventional user needs</span>
<span class="sd">    to interact with. Looking at the three &quot;levels&quot; of use cases, from simplest</span>
<span class="sd">    to most complicated, we have:</span>

<span class="sd">    Level 1: users interact with Aviary through input files (.csv or .yaml, TBD)</span>
<span class="sd">    Level 2: users interact with Aviary through a Python interface</span>
<span class="sd">    Level 3: users can modify Aviary&#39;s workings through Python and OpenMDAO</span>

<span class="sd">    This Problem object is simply a specialized OpenMDAO Problem that has</span>
<span class="sd">    additional methods to help users create and solve Aviary problems.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="AviaryProblem.__init__">
<a class="viewcode-back" href="../../../_srcdocs/packages/interface/methods_for_level2.html#aviary.interface.methods_for_level2.AviaryProblem.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">problem_type</span><span class="p">:</span> <span class="n">ProblemType</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">verbosity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">meta_data</span><span class="o">=</span><span class="n">BaseMetaData</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># Modify OpenMDAO&#39;s default_reports for this session.</span>
        <span class="n">new_reports</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;subsystems&#39;</span><span class="p">,</span>
            <span class="s1">&#39;mission&#39;</span><span class="p">,</span>
            <span class="s1">&#39;timeseries_csv&#39;</span><span class="p">,</span>
            <span class="s1">&#39;run_status&#39;</span><span class="p">,</span>
            <span class="s1">&#39;sizing_results&#39;</span><span class="p">,</span>
            <span class="s1">&#39;input_checks&#39;</span><span class="p">,</span>
            <span class="s1">&#39;overridden_variables&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">report</span> <span class="ow">in</span> <span class="n">new_reports</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">report</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_default_reports</span><span class="p">:</span>
                <span class="n">_default_reports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="c1"># If verbosity is set to anything but None, this defines how warnings are formatted for the</span>
        <span class="c1"># whole problem - warning format won&#39;t be updated if user requests a different verbosity</span>
        <span class="c1"># level for a specific method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">verbosity</span>
        <span class="n">set_warning_format</span><span class="p">(</span><span class="n">verbosity</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">problem_type</span> <span class="o">=</span> <span class="n">problem_type</span>
        <span class="k">if</span> <span class="n">problem_type</span> <span class="o">==</span> <span class="n">ProblemType</span><span class="o">.</span><span class="n">MULTI_MISSION</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">AviaryGroup</span><span class="p">()</span>
            <span class="c1"># This causes problems where aviary_inputs are stored in different places for</span>
            <span class="c1"># multi-mission vs. standard mission</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">aviary_inputs</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">aviary_groups_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">meta_data</span> <span class="o">=</span> <span class="n">meta_data</span>

        <span class="c1"># TODO try and find a better solution than a new custom flag - the issue is multimission</span>
        <span class="c1">#      problems don&#39;t have a consistent variable path to check the inputs later on</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_payload_range</span> <span class="o">=</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="AviaryProblem.load_inputs">
<a class="viewcode-back" href="../../../_srcdocs/packages/interface/methods_for_level2.html#aviary.interface.methods_for_level2.AviaryProblem.load_inputs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_inputs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">aircraft_data</span><span class="p">,</span>
        <span class="n">phase_info</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">problem_configurator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">meta_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">verbosity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method loads the aviary_values inputs and options that the user specifies. They could</span>
<span class="sd">        specify files to load and values to replace here as well.</span>

<span class="sd">        Phase info is also loaded if provided by the user. If phase_info is None, the appropriate</span>
<span class="sd">        default phase_info based on mission analysis method is used.</span>

<span class="sd">        This method is not strictly necessary; a user could also supply an AviaryValues object</span>
<span class="sd">        and/or phase_info dict of their own.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># We haven&#39;t read the input data yet, we don&#39;t know what desired run verbosity is</span>
        <span class="c1"># `self.verbosity` is &quot;true&quot; verbosity for entire run. `verbosity` is verbosity</span>
        <span class="c1"># override for just this method</span>
        <span class="k">if</span> <span class="n">verbosity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># compatibility with being passed int for verbosity</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="n">Verbosity</span><span class="p">(</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span>  <span class="c1"># usually None</span>

        <span class="k">if</span> <span class="n">meta_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Support for custom meta_data set.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta_data</span> <span class="o">=</span> <span class="n">meta_data</span>

        <span class="c1"># TODO: We cannot pass self.verbosity back up from load inputs for multi-mission because there could be multiple .csv files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">meta_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_data</span>
        <span class="n">aviary_inputs</span><span class="p">,</span> <span class="n">verbosity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">load_inputs</span><span class="p">(</span>
            <span class="n">aircraft_data</span><span class="o">=</span><span class="n">aircraft_data</span><span class="p">,</span>
            <span class="n">phase_info</span><span class="o">=</span><span class="n">phase_info</span><span class="p">,</span>
            <span class="n">problem_configurator</span><span class="o">=</span><span class="n">problem_configurator</span><span class="p">,</span>
            <span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">aviary_inputs</span> <span class="o">=</span> <span class="n">aviary_inputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">verbosity</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># if there are multiple load_inputs() calls, only the problem type from the first aviary_values is used</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">problem_type</span> <span class="o">=</span> <span class="n">aviary_inputs</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">PROBLEM_TYPE</span><span class="p">)</span>

        <span class="c1"># TODO try and find a better solution than a new custom flag - the issue is multimission</span>
        <span class="c1">#      problems don&#39;t have a consistent variable path to check the inputs later on</span>
        <span class="c1"># BUG you can&#39;t specify generating payload-range diagram via aviary_inputs after load_inputs</span>
        <span class="k">if</span> <span class="n">Settings</span><span class="o">.</span><span class="n">PAYLOAD_RANGE</span> <span class="ow">in</span> <span class="n">aviary_inputs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generate_payload_range</span> <span class="o">=</span> <span class="n">aviary_inputs</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">PAYLOAD_RANGE</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">aviary_inputs</span></div>


<div class="viewcode-block" id="AviaryProblem.load_external_subsystems">
<a class="viewcode-back" href="../../../_srcdocs/packages/interface/methods_for_level2.html#aviary.interface.methods_for_level2.AviaryProblem.load_external_subsystems">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_external_subsystems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">external_subsystems</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">verbosity</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add external subsystems to the AviaryProblem. For multi-mission problems, this adds the</span>
<span class="sd">        provided external subsystems to every AviaryGroup.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        external_subsystems : list of SubsystemBuilders</span>
<span class="sd">            List of all external subsystems to be added.</span>

<span class="sd">        verbosity : int, Verbosity (optional)</span>
<span class="sd">            Sets the printout level for the entire off-design problem that is ran.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># `self.verbosity` is &quot;true&quot; verbosity for entire run. `verbosity` is verbosity</span>
        <span class="c1"># override for just this method</span>
        <span class="k">if</span> <span class="n">verbosity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># compatibility with being passed int for verbosity</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="n">Verbosity</span><span class="p">(</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span>  <span class="c1"># defaults to BRIEF</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem_type</span> <span class="o">==</span> <span class="n">ProblemType</span><span class="o">.</span><span class="n">MULTI_MISSION</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aviary_groups_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">group</span><span class="o">.</span><span class="n">load_external_subsystems</span><span class="p">(</span>
                    <span class="n">external_subsystems</span><span class="o">=</span><span class="n">external_subsystems</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta_data</span> <span class="o">=</span> <span class="n">merge_meta_data</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_data</span><span class="p">,</span> <span class="n">group</span><span class="o">.</span><span class="n">meta_data</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">load_external_subsystems</span><span class="p">(</span>
                <span class="n">external_subsystems</span><span class="o">=</span><span class="n">external_subsystems</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta_data</span> <span class="o">=</span> <span class="n">merge_meta_data</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">meta_data</span><span class="p">])</span></div>


<div class="viewcode-block" id="AviaryProblem.add_aviary_group">
<a class="viewcode-back" href="../../../_srcdocs/packages/interface/methods_for_level2.html#aviary.interface.methods_for_level2.AviaryProblem.add_aviary_group">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_aviary_group</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">aircraft</span><span class="p">:</span> <span class="n">AviaryValues</span><span class="p">,</span>
        <span class="n">phase_info</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">problem_configurator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">verbosity</span><span class="p">:</span> <span class="n">Verbosity</span> <span class="o">=</span> <span class="n">Verbosity</span><span class="o">.</span><span class="n">BRIEF</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Used for creating a multi-mission problem. This method creates an AviaryGroup() for each</span>
<span class="sd">        aircraft and mission combination. The method loads and checks_and_preprocesses inputs, and</span>
<span class="sd">        then combines metadata.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : string</span>
<span class="sd">            A unique name that identifies this group which can be referenced later.</span>
<span class="sd">        aircraft : AviaryValues object</span>
<span class="sd">            Defines the aircraft configuration</span>
<span class="sd">        phase_info : dict</span>
<span class="sd">            Defines the mission the aircraft will fly</span>
<span class="sd">        subsystems : list of SubsystemBuilders</span>
<span class="sd">            List of all external subsystems to be added.</span>
<span class="sd">        problem_configurator ; ProblemConfigurator, optional</span>
<span class="sd">            Required when setting custom equations of motion. See two_dof_problem_configurator.py for an example.</span>
<span class="sd">        verbosity : Verbosity or int, optional</span>
<span class="sd">            Controls the level of printouts for this method.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        subsystem</span>
<span class="sd">            The AviaryGroup object containing the specified aircraft, mission, and engine model.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># `self.verbosity` is &quot;true&quot; verbosity for entire run. `verbosity` is verbosity</span>
        <span class="c1"># override for just this method</span>
        <span class="k">if</span> <span class="n">verbosity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># compatibility with being passed int for verbosity</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="n">Verbosity</span><span class="p">(</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span>  <span class="c1"># defaults to BRIEF</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">ProblemType</span><span class="o">.</span><span class="n">MULTI_MISSION</span><span class="p">:</span>
            <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;add_aviary_group() should only be called when ProblemType is MULTI_MISSION.&#39;</span>
            <span class="p">)</span>

        <span class="n">sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">AviaryGroup</span><span class="p">())</span>
        <span class="n">sub</span><span class="o">.</span><span class="n">meta_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_data</span>
        <span class="n">sub</span><span class="o">.</span><span class="n">load_inputs</span><span class="p">(</span>
            <span class="n">aircraft_data</span><span class="o">=</span><span class="n">aircraft</span><span class="p">,</span>
            <span class="n">phase_info</span><span class="o">=</span><span class="n">phase_info</span><span class="p">,</span>
            <span class="n">problem_configurator</span><span class="o">=</span><span class="n">problem_configurator</span><span class="p">,</span>
            <span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">sub</span><span class="o">.</span><span class="n">check_and_preprocess_inputs</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">aviary_groups_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">sub</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># If problem-level verbosity was not defined, use the verbosity specified in the first</span>
            <span class="c1"># added AviaryGroup</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">sub</span><span class="o">.</span><span class="n">verbosity</span>

        <span class="c1"># TODO try and find a better solution than a new custom flag - the issue is multimission</span>
        <span class="c1">#      problems don&#39;t have a consistent variable path to check the inputs later on</span>
        <span class="k">if</span> <span class="n">Settings</span><span class="o">.</span><span class="n">PAYLOAD_RANGE</span> <span class="ow">in</span> <span class="n">sub</span><span class="o">.</span><span class="n">aviary_inputs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generate_payload_range</span> <span class="o">=</span> <span class="n">sub</span><span class="o">.</span><span class="n">aviary_inputs</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">PAYLOAD_RANGE</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">sub</span></div>


<div class="viewcode-block" id="AviaryProblem.check_and_preprocess_inputs">
<a class="viewcode-back" href="../../../_srcdocs/packages/interface/methods_for_level2.html#aviary.interface.methods_for_level2.AviaryProblem.check_and_preprocess_inputs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_and_preprocess_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method checks the user-supplied input values for any potential problems and</span>
<span class="sd">        preprocesses the inputs to prepare them for use in the Aviary problem. Also estimates</span>
<span class="sd">        initial conditions for mission analysis.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># `self.verbosity` is &quot;true&quot; verbosity for entire run. `verbosity` is verbosity</span>
        <span class="c1"># override for just this method</span>
        <span class="k">if</span> <span class="n">verbosity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># compatibility with being passed int for verbosity</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="n">Verbosity</span><span class="p">(</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span>  <span class="c1"># defaults to BRIEF</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem_type</span> <span class="o">==</span> <span class="n">ProblemType</span><span class="o">.</span><span class="n">MULTI_MISSION</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aviary_groups_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">group</span><span class="o">.</span><span class="n">check_and_preprocess_inputs</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">check_and_preprocess_inputs</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span></div>


<div class="viewcode-block" id="AviaryProblem.add_pre_mission_systems">
<a class="viewcode-back" href="../../../_srcdocs/packages/interface/methods_for_level2.html#aviary.interface.methods_for_level2.AviaryProblem.add_pre_mission_systems">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_pre_mission_systems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add pre-mission systems to the Aviary problem. These systems are executed before the</span>
<span class="sd">        mission.</span>

<span class="sd">        Depending on the mission model specified (`FLOPS` or `GASP`), this method adds various</span>
<span class="sd">        subsystems to the aircraft model. For the `FLOPS` mission model, a takeoff phase is added</span>
<span class="sd">        using the Takeoff class with the number of engines and airport altitude specified. For the</span>
<span class="sd">        `GASP` mission model, three subsystems are added: a TaxiSegment subsystem, an ExecComp to</span>
<span class="sd">        calculate the time to initiate gear and flaps, and an ExecComp to calculate the speed at</span>
<span class="sd">        which to initiate rotation. All subsystems are promoted with aircraft and mission inputs and</span>
<span class="sd">        outputs as appropriate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># `self.verbosity` is &quot;true&quot; verbosity for entire run. `verbosity` is verbosity</span>
        <span class="c1"># override for just this method</span>
        <span class="k">if</span> <span class="n">verbosity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># compatibility with being passed int for verbosity</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="n">Verbosity</span><span class="p">(</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span>  <span class="c1"># defaults to BRIEF</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem_type</span> <span class="o">==</span> <span class="n">ProblemType</span><span class="o">.</span><span class="n">MULTI_MISSION</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aviary_groups_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">group</span><span class="o">.</span><span class="n">add_pre_mission_systems</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_pre_mission_systems</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span></div>


<div class="viewcode-block" id="AviaryProblem.add_phases">
<a class="viewcode-back" href="../../../_srcdocs/packages/interface/methods_for_level2.html#aviary.interface.methods_for_level2.AviaryProblem.add_phases">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_phases</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">phase_info_parameterization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">parallel_phases</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbosity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add the mission phases to the problem trajectory based on the user-specified</span>
<span class="sd">        phase_info dictionary.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        phase_info_parameterization (function, optional): A function that takes in the phase_info</span>
<span class="sd">            dictionary and aviary_inputs and returns modified phase_info. Defaults to None.</span>

<span class="sd">        parallel_phases (bool, optional): If True, the top-level container of all phases will be a</span>
<span class="sd">            ParallelGroup, otherwise it will be a standard OpenMDAO Group. Defaults to True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        &lt;Trajectory&gt;</span>
<span class="sd">            The Dymos Trajectory object containing the added mission phases.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># `self.verbosity` is &quot;true&quot; verbosity for entire run. `verbosity` is verbosity</span>
        <span class="c1"># override for just this method</span>
        <span class="k">if</span> <span class="n">verbosity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># compatibility with being passed int for verbosity</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="n">Verbosity</span><span class="p">(</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span>  <span class="c1"># defaults to BRIEF</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem_type</span> <span class="o">==</span> <span class="n">ProblemType</span><span class="o">.</span><span class="n">MULTI_MISSION</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aviary_groups_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">Traj</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">add_phases</span><span class="p">(</span>
                    <span class="n">phase_info_parameterization</span><span class="o">=</span><span class="n">phase_info_parameterization</span><span class="p">,</span>
                    <span class="n">parallel_phases</span><span class="o">=</span><span class="n">parallel_phases</span><span class="p">,</span>
                    <span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span>
                    <span class="n">comm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Traj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_phases</span><span class="p">(</span>
                <span class="n">phase_info_parameterization</span><span class="o">=</span><span class="n">phase_info_parameterization</span><span class="p">,</span>
                <span class="n">parallel_phases</span><span class="o">=</span><span class="n">parallel_phases</span><span class="p">,</span>
                <span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span>
                <span class="n">comm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">Traj</span></div>


<div class="viewcode-block" id="AviaryProblem.add_post_mission_systems">
<a class="viewcode-back" href="../../../_srcdocs/packages/interface/methods_for_level2.html#aviary.interface.methods_for_level2.AviaryProblem.add_post_mission_systems">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_post_mission_systems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add post-mission systems to the aircraft model. This is akin to the pre-mission</span>
<span class="sd">        group or the &quot;premission_systems&quot;, but occurs after the mission in the execution</span>
<span class="sd">        order.</span>

<span class="sd">        Depending on the mission model specified (`FLOPS` or `GASP`), this method adds</span>
<span class="sd">        various subsystems to the aircraft model. For the `FLOPS` mission model, a</span>
<span class="sd">        landing phase is added using the Landing class with the wing area and lift</span>
<span class="sd">        coefficient specified, and a takeoff constraints ExecComp is added to enforce</span>
<span class="sd">        mass, range, velocity, and altitude continuity between the takeoff and climb</span>
<span class="sd">        phases. The landing subsystem is promoted with aircraft and mission inputs and</span>
<span class="sd">        outputs as appropriate, while the takeoff constraints ExecComp is only promoted</span>
<span class="sd">        with mission inputs and outputs.</span>

<span class="sd">        For the `GASP` mission model, four subsystems are added: a LandingSegment</span>
<span class="sd">        subsystem, an ExecComp to calculate the reserve fuel required, an ExecComp to</span>
<span class="sd">        calculate the overall fuel burn, and three ExecComps to calculate various</span>
<span class="sd">        mission objectives and constraints. All subsystems are promoted with aircraft</span>
<span class="sd">        and mission inputs and outputs as appropriate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># `self.verbosity` is &quot;true&quot; verbosity for entire run. `verbosity` is verbosity</span>
        <span class="c1"># override for just this method</span>
        <span class="k">if</span> <span class="n">verbosity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># compatibility with being passed int for verbosity</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="n">Verbosity</span><span class="p">(</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span>  <span class="c1"># defaults to BRIEF</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem_type</span> <span class="o">==</span> <span class="n">ProblemType</span><span class="o">.</span><span class="n">MULTI_MISSION</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aviary_groups_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">group</span><span class="o">.</span><span class="n">add_post_mission_systems</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_post_mission_systems</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span></div>


<div class="viewcode-block" id="AviaryProblem.link_phases">
<a class="viewcode-back" href="../../../_srcdocs/packages/interface/methods_for_level2.html#aviary.interface.methods_for_level2.AviaryProblem.link_phases">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">link_phases</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Link phases together after they&#39;ve been added.</span>

<span class="sd">        Based on which phases the user has selected, we might need special logic to do the Dymos</span>
<span class="sd">        linkages correctly. Some of those connections for the simple GASP and FLOPS mission are</span>
<span class="sd">        shown here.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># `self.verbosity` is &quot;true&quot; verbosity for entire run. `verbosity` is verbosity</span>
        <span class="c1"># override for just this method</span>
        <span class="k">if</span> <span class="n">verbosity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># compatibility with being passed int for verbosity</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="n">Verbosity</span><span class="p">(</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span>  <span class="c1"># defaults to BRIEF</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem_type</span> <span class="o">==</span> <span class="n">ProblemType</span><span class="o">.</span><span class="n">MULTI_MISSION</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aviary_groups_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">group</span><span class="o">.</span><span class="n">link_phases</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span> <span class="n">comm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">link_phases</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span> <span class="n">comm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="p">)</span></div>


<div class="viewcode-block" id="AviaryProblem.add_driver">
<a class="viewcode-back" href="../../../_srcdocs/packages/interface/methods_for_level2.html#aviary.interface.methods_for_level2.AviaryProblem.add_driver">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_driver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_coloring</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an optimization driver to the Aviary problem.</span>

<span class="sd">        Depending on the provided optimizer, the method instantiates the relevant driver</span>
<span class="sd">        (ScipyOptimizeDriver or pyOptSparseDriver) and sets the optimizer options. Options for</span>
<span class="sd">        &#39;SNOPT&#39;, &#39;IPOPT&#39;, and &#39;SLSQP&#39; are specified. The method also allows for the declaration of</span>
<span class="sd">        coloring and setting debug print options.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        optimizer : str</span>
<span class="sd">            The name of the optimizer to use. It can be &quot;SLSQP&quot;, &quot;SNOPT&quot;, &quot;IPOPT&quot; or others</span>
<span class="sd">            supported by OpenMDAO. If &quot;SLSQP&quot;, it will instantiate a ScipyOptimizeDriver, else it</span>
<span class="sd">            will instantiate a pyOptSparseDriver.</span>

<span class="sd">        use_coloring : bool, optional</span>
<span class="sd">            If True (default), the driver will declare coloring, which can speed up derivative</span>
<span class="sd">            computations.</span>

<span class="sd">        max_iter : int, optional</span>
<span class="sd">            The maximum number of iterations allowed for the optimization process. Default is 50.</span>
<span class="sd">            This option is applicable to &quot;SNOPT&quot;, &quot;IPOPT&quot;, and &quot;SLSQP&quot; optimizers.</span>

<span class="sd">        verbosity : Verbosity or int, optional</span>
<span class="sd">            Controls the level of printouts for this method. If None, uses the value of</span>
<span class="sd">            Settings.VERBOSITY in provided aircraft data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># `self.verbosity` is &quot;true&quot; verbosity for entire run. `verbosity` is verbosity</span>
        <span class="c1"># override for just this method</span>
        <span class="k">if</span> <span class="n">verbosity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># compatibility with being passed int for verbosity</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="n">Verbosity</span><span class="p">(</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span>  <span class="c1"># defaults to BRIEF</span>

        <span class="c1"># Set defaults for optimizer and use_coloring</span>
        <span class="k">if</span> <span class="n">optimizer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">optimizer</span> <span class="o">=</span> <span class="s1">&#39;IPOPT&#39;</span>
        <span class="k">if</span> <span class="n">use_coloring</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">use_coloring</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># check if optimizer is SLSQP</span>
        <span class="k">if</span> <span class="n">optimizer</span> <span class="o">==</span> <span class="s1">&#39;SLSQP&#39;</span><span class="p">:</span>
            <span class="n">driver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">ScipyOptimizeDriver</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">driver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">pyOptSparseDriver</span><span class="p">()</span>

        <span class="n">driver</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;optimizer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">optimizer</span>
        <span class="k">if</span> <span class="n">use_coloring</span><span class="p">:</span>
            <span class="c1"># define coloring options by verbosity</span>
            <span class="k">if</span> <span class="n">verbosity</span> <span class="o">&lt;</span> <span class="n">Verbosity</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>  <span class="c1"># QUIET, BRIEF</span>
                <span class="n">driver</span><span class="o">.</span><span class="n">declare_coloring</span><span class="p">(</span><span class="n">show_summary</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">verbosity</span> <span class="o">==</span> <span class="n">Verbosity</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>
                <span class="n">driver</span><span class="o">.</span><span class="n">declare_coloring</span><span class="p">(</span><span class="n">show_summary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># DEBUG</span>
                <span class="n">driver</span><span class="o">.</span><span class="n">declare_coloring</span><span class="p">(</span><span class="n">show_summary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_sparsity</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">driver</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;optimizer&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SNOPT&#39;</span><span class="p">:</span>
            <span class="c1"># Print Options #</span>
            <span class="k">if</span> <span class="n">verbosity</span> <span class="o">==</span> <span class="n">Verbosity</span><span class="o">.</span><span class="n">QUIET</span><span class="p">:</span>
                <span class="n">isumm</span><span class="p">,</span> <span class="n">iprint</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="n">verbosity</span> <span class="o">==</span> <span class="n">Verbosity</span><span class="o">.</span><span class="n">BRIEF</span><span class="p">:</span>
                <span class="n">isumm</span><span class="p">,</span> <span class="n">iprint</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="n">verbosity</span> <span class="o">&gt;</span> <span class="n">Verbosity</span><span class="o">.</span><span class="n">BRIEF</span><span class="p">:</span>  <span class="c1"># VERBOSE, DEBUG</span>
                <span class="n">isumm</span><span class="p">,</span> <span class="n">iprint</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">opt_settings</span><span class="p">[</span><span class="s1">&#39;iSumm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">isumm</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">opt_settings</span><span class="p">[</span><span class="s1">&#39;iPrint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">iprint</span>
            <span class="c1"># Optimizer Settings #</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">opt_settings</span><span class="p">[</span><span class="s1">&#39;Major iterations limit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_iter</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">opt_settings</span><span class="p">[</span><span class="s1">&#39;Major optimality tolerance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-4</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">opt_settings</span><span class="p">[</span><span class="s1">&#39;Major feasibility tolerance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-6</span>

        <span class="k">elif</span> <span class="n">driver</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;optimizer&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;IPOPT&#39;</span><span class="p">:</span>
            <span class="c1"># Print Options #</span>
            <span class="k">if</span> <span class="n">verbosity</span> <span class="o">==</span> <span class="n">Verbosity</span><span class="o">.</span><span class="n">QUIET</span><span class="p">:</span>
                <span class="n">print_level</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">driver</span><span class="o">.</span><span class="n">opt_settings</span><span class="p">[</span><span class="s1">&#39;print_user_options&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span>
            <span class="k">elif</span> <span class="n">verbosity</span> <span class="o">==</span> <span class="n">Verbosity</span><span class="o">.</span><span class="n">BRIEF</span><span class="p">:</span>
                <span class="n">print_level</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># minimum to get exit status</span>
                <span class="n">driver</span><span class="o">.</span><span class="n">opt_settings</span><span class="p">[</span><span class="s1">&#39;print_user_options&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span>
                <span class="n">driver</span><span class="o">.</span><span class="n">opt_settings</span><span class="p">[</span><span class="s1">&#39;print_frequency_iter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="k">elif</span> <span class="n">verbosity</span> <span class="o">==</span> <span class="n">Verbosity</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>
                <span class="n">print_level</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># DEBUG</span>
                <span class="n">print_level</span> <span class="o">=</span> <span class="mi">7</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">opt_settings</span><span class="p">[</span><span class="s1">&#39;print_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">print_level</span>
            <span class="c1"># Optimizer Settings #</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">opt_settings</span><span class="p">[</span><span class="s1">&#39;tol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0e-6</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">opt_settings</span><span class="p">[</span><span class="s1">&#39;mu_init&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-5</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">opt_settings</span><span class="p">[</span><span class="s1">&#39;max_iter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_iter</span>
            <span class="c1"># for faster convergence</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">opt_settings</span><span class="p">[</span><span class="s1">&#39;nlp_scaling_method&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;gradient-based&#39;</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">opt_settings</span><span class="p">[</span><span class="s1">&#39;alpha_for_y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;safer-min-dual-infeas&#39;</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">opt_settings</span><span class="p">[</span><span class="s1">&#39;mu_strategy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;monotone&#39;</span>

        <span class="k">elif</span> <span class="n">driver</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;optimizer&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SLSQP&#39;</span><span class="p">:</span>
            <span class="c1"># Print Options #</span>
            <span class="k">if</span> <span class="n">verbosity</span> <span class="o">==</span> <span class="n">Verbosity</span><span class="o">.</span><span class="n">QUIET</span><span class="p">:</span>
                <span class="n">disp</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">disp</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;disp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">disp</span>
            <span class="c1"># Optimizer Settings #</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;tol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-9</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;maxiter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_iter</span>

        <span class="c1"># pyoptsparse print settings for both SNOPT, IPOPT</span>
        <span class="k">if</span> <span class="n">optimizer</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;SNOPT&#39;</span><span class="p">,</span> <span class="s1">&#39;IPOPT&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verbosity</span> <span class="o">==</span> <span class="n">Verbosity</span><span class="o">.</span><span class="n">QUIET</span><span class="p">:</span>
                <span class="n">driver</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;print_results&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">verbosity</span> <span class="o">&lt;</span> <span class="n">Verbosity</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>  <span class="c1"># QUIET, BRIEF, VERBOSE</span>
                <span class="n">driver</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;print_results&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;minimal&#39;</span>
            <span class="k">elif</span> <span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="n">Verbosity</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
                <span class="n">driver</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;print_opt_prob&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># optimizer agnostic settings</span>
        <span class="k">if</span> <span class="n">verbosity</span> <span class="o">==</span> <span class="n">Verbosity</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;debug_print&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;desvars&#39;</span><span class="p">,</span>
                <span class="s1">&#39;ln_cons&#39;</span><span class="p">,</span>
                <span class="s1">&#39;nl_cons&#39;</span><span class="p">,</span>
                <span class="s1">&#39;objs&#39;</span><span class="p">,</span>
            <span class="p">]</span></div>


<div class="viewcode-block" id="AviaryProblem.add_design_variables">
<a class="viewcode-back" href="../../../_srcdocs/packages/interface/methods_for_level2.html#aviary.interface.methods_for_level2.AviaryProblem.add_design_variables">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_design_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds design variables to the Aviary problem.</span>

<span class="sd">        Depending on the mission model and problem type, different design variables and constraints</span>
<span class="sd">        are added.</span>

<span class="sd">        If using the FLOPS model, a design variable is added for the gross mass of the aircraft,</span>
<span class="sd">        with a lower bound of 10 lbm and an upper bound of 900,000 lbm.</span>

<span class="sd">        If using the GASP model, the following design variables are added depending on the mission</span>
<span class="sd">        type:</span>
<span class="sd">        - the initial thrust-to-weight ratio of the aircraft during ascent</span>
<span class="sd">        - the duration of the ascent phase</span>
<span class="sd">        - the time constant for the landing gear actuation</span>
<span class="sd">        - the time constant for the flaps actuation</span>

<span class="sd">        In addition, two constraints are added for the GASP model:</span>
<span class="sd">        - the initial altitude of the aircraft with gear extended is constrained to be 50 ft</span>
<span class="sd">        - the initial altitude of the aircraft with flaps extended is constrained to be 400 ft</span>

<span class="sd">        If solving a sizing problem, a design variable is added for the gross mass of the aircraft,</span>
<span class="sd">        and another for the gross mass of the aircraft computed during the mission. A constraint is</span>
<span class="sd">        also added to ensure that the residual range is zero.</span>

<span class="sd">        If solving an alternate problem, only a design variable for the gross mass of the aircraft</span>
<span class="sd">        computed during the mission is added. A constraint is also added to ensure that the residual</span>
<span class="sd">        range is zero.</span>

<span class="sd">        In all cases, a design variable is added for the final cruise mass of the aircraft, with no</span>
<span class="sd">        upper bound, and a residual mass constraint is added to ensure that the mass balances.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># `self.verbosity` is &quot;true&quot; verbosity for entire run. `verbosity` is verbosity</span>
        <span class="c1"># override for just this method</span>
        <span class="k">if</span> <span class="n">verbosity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># compatibility with being passed int for verbosity</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="n">Verbosity</span><span class="p">(</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span>  <span class="c1"># defaults to BRIEF</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem_type</span> <span class="o">==</span> <span class="n">ProblemType</span><span class="o">.</span><span class="n">MULTI_MISSION</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aviary_groups_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">group</span><span class="o">.</span><span class="n">add_design_variables</span><span class="p">(</span><span class="n">problem_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">problem_type</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_variables</span><span class="p">(</span><span class="n">problem_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">problem_type</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span></div>


<div class="viewcode-block" id="AviaryProblem.add_objective">
<a class="viewcode-back" href="../../../_srcdocs/packages/interface/methods_for_level2.html#aviary.interface.methods_for_level2.AviaryProblem.add_objective">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_objective</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objective_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add the objective function based on the given objective_type and ref.</span>

<span class="sd">        NOTE: the ref value should be positive for values you&#39;re trying to minimize and negative for</span>
<span class="sd">        values you&#39;re trying to maximize. Please check and double-check that your ref value makes</span>
<span class="sd">        sense for the objective you&#39;re using.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        objective_type : str</span>
<span class="sd">            The type of objective to add. Options are &#39;mass&#39;, &#39;hybrid_objective&#39;, &#39;fuel_burned&#39;, and</span>
<span class="sd">            &#39;fuel&#39;.</span>
<span class="sd">        ref : float</span>
<span class="sd">            The reference value for the objective. If None, a default value will be used based on</span>
<span class="sd">            the objective type. Please see the `default_ref_values` dict for these default values.</span>
<span class="sd">        verbosity : Verbosity or int, optional</span>
<span class="sd">            Controls the level of printouts for this method. If None, uses the value of</span>
<span class="sd">            Settings.VERBOSITY in provided aircraft data.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">            ValueError: If an invalid problem type is provided.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># `self.verbosity` is &quot;true&quot; verbosity for entire run. `verbosity` is verbosity</span>
        <span class="c1"># override for just this method</span>
        <span class="k">if</span> <span class="n">verbosity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># compatibility with being passed int for verbosity</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="n">Verbosity</span><span class="p">(</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span>  <span class="c1"># defaults to BRIEF</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span>
            <span class="s1">&#39;fuel_obj&#39;</span><span class="p">,</span>
            <span class="n">om</span><span class="o">.</span><span class="n">ExecComp</span><span class="p">(</span>
                <span class="s1">&#39;reg_objective = overall_fuel/10000 + ascent_duration/30.&#39;</span><span class="p">,</span>
                <span class="n">reg_objective</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;unitless&#39;</span><span class="p">},</span>
                <span class="n">ascent_duration</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
                <span class="n">overall_fuel</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;lbm&#39;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">promotes_inputs</span><span class="o">=</span><span class="p">[</span>
                <span class="p">(</span><span class="s1">&#39;ascent_duration&#39;</span><span class="p">,</span> <span class="n">Mission</span><span class="o">.</span><span class="n">Takeoff</span><span class="o">.</span><span class="n">ASCENT_DURATION</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;overall_fuel&#39;</span><span class="p">,</span> <span class="n">Mission</span><span class="o">.</span><span class="n">Summary</span><span class="o">.</span><span class="n">TOTAL_FUEL_MASS</span><span class="p">),</span>
            <span class="p">],</span>
            <span class="n">promotes_outputs</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;reg_objective&#39;</span><span class="p">,</span> <span class="n">Mission</span><span class="o">.</span><span class="n">Objectives</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)],</span>
        <span class="p">)</span>

        <span class="c1"># TODO: All references to self.model. will need to be updated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span>
            <span class="s1">&#39;range_obj&#39;</span><span class="p">,</span>
            <span class="n">om</span><span class="o">.</span><span class="n">ExecComp</span><span class="p">(</span>
                <span class="s1">&#39;reg_objective = -actual_range/1000 + ascent_duration/30.&#39;</span><span class="p">,</span>
                <span class="n">reg_objective</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;unitless&#39;</span><span class="p">},</span>
                <span class="n">ascent_duration</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
                <span class="n">actual_range</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">target_range</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;NM&#39;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">promotes_inputs</span><span class="o">=</span><span class="p">[</span>
                <span class="p">(</span><span class="s1">&#39;actual_range&#39;</span><span class="p">,</span> <span class="n">Mission</span><span class="o">.</span><span class="n">Summary</span><span class="o">.</span><span class="n">RANGE</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;ascent_duration&#39;</span><span class="p">,</span> <span class="n">Mission</span><span class="o">.</span><span class="n">Takeoff</span><span class="o">.</span><span class="n">ASCENT_DURATION</span><span class="p">),</span>
            <span class="p">],</span>
            <span class="n">promotes_outputs</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;reg_objective&#39;</span><span class="p">,</span> <span class="n">Mission</span><span class="o">.</span><span class="n">Objectives</span><span class="o">.</span><span class="n">RANGE</span><span class="p">)],</span>
        <span class="p">)</span>

        <span class="c1"># Dictionary for default reference values</span>
        <span class="n">default_ref_values</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;mass&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">5e4</span><span class="p">,</span>
            <span class="s1">&#39;hybrid_objective&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">5e4</span><span class="p">,</span>
            <span class="s1">&#39;fuel_burned&#39;</span><span class="p">:</span> <span class="mf">1e4</span><span class="p">,</span>
            <span class="s1">&#39;fuel&#39;</span><span class="p">:</span> <span class="mf">1e4</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Check if an objective type is specified</span>
        <span class="k">if</span> <span class="n">objective_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">ref</span> <span class="k">if</span> <span class="n">ref</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">default_ref_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">objective_type</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">final_phase_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">regular_phases</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">objective_type</span> <span class="o">==</span> <span class="s1">&#39;mass&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;traj.</span><span class="si">{</span><span class="n">final_phase_name</span><span class="si">}</span><span class="s1">.timeseries.</span><span class="si">{</span><span class="n">Dynamic</span><span class="o">.</span><span class="n">Vehicle</span><span class="o">.</span><span class="n">MASS</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="n">index</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">ref</span><span class="o">=</span><span class="n">ref</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">objective_type</span> <span class="o">==</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;traj.</span><span class="si">{</span><span class="n">final_phase_name</span><span class="si">}</span><span class="s1">.timeseries.time&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">ref</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="n">objective_type</span> <span class="o">==</span> <span class="s1">&#39;hybrid_objective&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_hybrid_objective</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mission_info</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span><span class="s1">&#39;obj_comp.obj&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">objective_type</span> <span class="o">==</span> <span class="s1">&#39;fuel_burned&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span><span class="n">Mission</span><span class="o">.</span><span class="n">Summary</span><span class="o">.</span><span class="n">FUEL_BURNED</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">ref</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">objective_type</span> <span class="o">==</span> <span class="s1">&#39;fuel&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span><span class="n">Mission</span><span class="o">.</span><span class="n">Objectives</span><span class="o">.</span><span class="n">FUEL</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">ref</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">objective_type</span><span class="si">}</span><span class="s2"> is not a valid objective. &#39;objective_type&#39; must &quot;</span>
                    <span class="s1">&#39;be one of the following: mass, time, hybrid_objective, &#39;</span>
                    <span class="s1">&#39;fuel_burned, or fuel&#39;</span>
                <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># If no &#39;objective_type&#39; is specified, we handle based on &#39;problem_type&#39;</span>
            <span class="c1"># If &#39;ref&#39; is not specified, assign a default value</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">ref</span> <span class="k">if</span> <span class="n">ref</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem_type</span> <span class="ow">is</span> <span class="n">ProblemType</span><span class="o">.</span><span class="n">SIZING</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span><span class="n">Mission</span><span class="o">.</span><span class="n">Objectives</span><span class="o">.</span><span class="n">FUEL</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">ref</span><span class="p">)</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem_type</span> <span class="ow">is</span> <span class="n">ProblemType</span><span class="o">.</span><span class="n">ALTERNATE</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span><span class="n">Mission</span><span class="o">.</span><span class="n">Objectives</span><span class="o">.</span><span class="n">FUEL</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">ref</span><span class="p">)</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem_type</span> <span class="ow">is</span> <span class="n">ProblemType</span><span class="o">.</span><span class="n">FALLOUT</span><span class="p">:</span>
                <span class="c1"># if ref &gt; 0:</span>
                <span class="c1">#    # Maximize range.</span>
                <span class="c1">#    ref = -ref</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span><span class="n">Mission</span><span class="o">.</span><span class="n">Objectives</span><span class="o">.</span><span class="n">RANGE</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">ref</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">problem_type</span><span class="si">}</span><span class="s1"> is not a valid problem type.&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="AviaryProblem.add_design_var_default">
<a class="viewcode-back" href="../../../_srcdocs/packages/interface/methods_for_level2.html#aviary.interface.methods_for_level2.AviaryProblem.add_design_var_default">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_design_var_default</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">lower</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">upper</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">units</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">src_shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">default_val</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ref</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a design variable to the problem as well as initialized a default value for that design variable.</span>

<span class="sd">        The default value can be over-written after setup with prob.set_val()</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : string</span>
<span class="sd">            A unique name that identifies this design variable.</span>
<span class="sd">        lower : float, optional</span>
<span class="sd">            The lowest value that the optimizer can choose for this design variable.</span>
<span class="sd">        upper : float, optional</span>
<span class="sd">            The largest value that the optimizer can choose for this design variable.</span>
<span class="sd">        src_shape : int or tuple, optional</span>
<span class="sd">            Assumed shape of any connected source or higher level promoted input.</span>
<span class="sd">        default_val : float or ndarray, optional</span>
<span class="sd">            The default value to be assigned to this design variable.</span>
<span class="sd">        ref : float or ndarray, optional</span>
<span class="sd">            Value of design var that scales to 1.0 in the driver.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">upper</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">ref</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">default_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">set_input_defaults</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">default_val</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span> <span class="n">src_shape</span><span class="o">=</span><span class="n">src_shape</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="AviaryProblem.set_design_range">
<a class="viewcode-back" href="../../../_srcdocs/packages/interface/methods_for_level2.html#aviary.interface.methods_for_level2.AviaryProblem.set_design_range">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_design_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">missions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">range</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># TODO: What happens if design range is specified in CSV??? should be able to access from group.aviary_values</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Used for multi-mission problems. This method finds the longest mission and sets its range</span>
<span class="sd">        as the design range for all AviaryGroups. design_range is used within Aviary for sizing</span>
<span class="sd">        subsystems (avionics and AC). This could be simpllified in the future if there was a</span>
<span class="sd">        single pre-mission for similar aircraft.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        missions : list[str]</span>
<span class="sd">            The names of all the missions instantiated via add_aviary_group()</span>
<span class="sd">        range : str</span>
<span class="sd">            The promoted name of the range variable. i.e. &quot;Aircraft1.Range&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">matching_names</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aviary_groups_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">missions</span>
        <span class="p">]</span>
        <span class="n">design_range</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># loop through all the phase_info and extract target ranges</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">matching_names</span><span class="p">:</span>
            <span class="n">target_range</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">post_mission_info</span><span class="p">[</span><span class="s1">&#39;target_range&#39;</span><span class="p">]</span>
            <span class="n">design_range</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">convert_units</span><span class="p">(</span><span class="n">target_range</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="s1">&#39;nmi&#39;</span><span class="p">))</span>
        <span class="c1"># TODO: loop through all the .csv files and extract Mission.Design.RANGE</span>
        <span class="n">design_range_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">design_range</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="nb">range</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">design_range_max</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;nmi&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="AviaryProblem.add_composite_objective">
<a class="viewcode-back" href="../../../_srcdocs/packages/interface/methods_for_level2.html#aviary.interface.methods_for_level2.AviaryProblem.add_composite_objective">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_composite_objective</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates composite_objective output by assemblin an ExecComp based on a variety of AviaryGroup</span>
<span class="sd">        outputs selected by the user. A number of different outputs from the same or different</span>
<span class="sd">        aricraft can be combined in this way such as creating an objective function based on fuel</span>
<span class="sd">        plus noise emissions. Each objective output should include a weight otherwise the weight will be</span>
<span class="sd">        assumed to be equal (i.e. fuel is equally important as reducing noise emissions).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *args : a list of 3-tuple, 2-tuple, str. Or it can be left empty</span>
<span class="sd">            If 3-tuple: (model, output, weight)</span>
<span class="sd">            If 2-tuple: (model, output) or (output, weight)</span>
<span class="sd">            If 1-tuple: (output) or &#39;fuel&#39;, &#39;fuel_burned&#39;, &#39;mass&#39;, &#39;range&#39;, &#39;time&#39;</span>
<span class="sd">            If empty, information will be populated based on problem_type:</span>
<span class="sd">            - If ProblemType = FALLOUT, objective = Mission.Objectives.RANGE</span>
<span class="sd">            - If ProblemType = Sizing or Alternate, objective = Mission.Objectives.FUEL</span>

<span class="sd">            Example inputs can be any of the following:</span>
<span class="sd">            (&#39;fuel&#39;)</span>
<span class="sd">            (Mission.Summary.FUEL_BURNED)</span>
<span class="sd">            (Mission.Summary.FUEL_BURNED, Mission.Summary.CO2)</span>
<span class="sd">            (&#39;model1&#39;, Mission.Summary.FUEL_BURNED)</span>
<span class="sd">            (Mission.Summary.FUEL_BURNED, 1.0)</span>
<span class="sd">            (Mission.Summary.FUEL_BURNED, 1.0), (Mission.Summary.CO2, 2.0)</span>
<span class="sd">            (&#39;model1&#39;, Mission.Summary.FUEL_BURNED), (&#39;model2&#39;, Mission.Summary.CO2)</span>
<span class="sd">            (&#39;model1&#39;, Mission.Summary.FUEL_BURNED, 1.0), (&#39;model2&#39;, Mission.Summary.CO2, 2.0)</span>

<span class="sd">        ref : float, optional</span>
<span class="sd">            Reference value for the final objective for scaling.</span>

<span class="sd">        Behavior</span>
<span class="sd">        --------</span>
<span class="sd">        - Connects each specified mission output into a newly created `ExecComp` block.</span>
<span class="sd">        - Computes a weighted sum: each output is weighted by both the total weights</span>
<span class="sd">        - Adds the result as the final objective named `&#39;composite_objective&#39;`, accessible at the top level model.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># There are LOTS of different ways for the users to input str, 2-tuple, or 3-tuple into *args</span>
        <span class="c1"># Correct combinations are (output), (output, weight), (model, output), or (model, output, weight).</span>
        <span class="c1"># We have to catch every case and advise the user on how to corect their errors and add defaults as needed.</span>
        <span class="n">default_model</span> <span class="o">=</span> <span class="s1">&#39;model&#39;</span>
        <span class="n">default_weight</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">objectives</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">model</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">arg</span>
                <span class="k">if</span> <span class="n">model</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aviary_groups_dict</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;The first element specified in </span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s1"> must be the model name.&#39;</span>
                    <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">first</span><span class="p">,</span> <span class="n">second</span> <span class="o">=</span> <span class="n">arg</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">second</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">first</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aviary_groups_dict</span><span class="p">:</span>
                        <span class="c1"># we have the model and output but no weight</span>
                        <span class="n">model</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">default_weight</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s1">&#39;The first element specified in </span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s1"> must be the model name.&#39;</span>
                        <span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">second</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">first</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aviary_groups_dict</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s1">&#39;When specifying </span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s1">, the user specified a model name and a weight &#39;</span>
                            <span class="sa">f</span><span class="s1">&#39;but did not specify what output from that model the weight should be applied to.&#39;</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># we have the output and the weight but not model</span>
                        <span class="n">model</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">default_model</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">second</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;The user specified </span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s1"> which is not a 2-tuple of (model, output) or (output, weight).&#39;</span>
                    <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">arg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aviary_groups_dict</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;When specifying &#39;</span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s2">&#39;, the user provided only a model name &quot;</span>
                        <span class="sa">f</span><span class="s1">&#39;but did not specify what output from that model should be used as the objective.&#39;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># we have an output and we use the default model and weights</span>
                    <span class="n">model</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">default_model</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">default_weight</span>

            <span class="c1"># in some cases the users provides no input and we can derive the objectie from the problem type:</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">problem_type</span> <span class="ow">is</span> <span class="n">ProblemType</span><span class="o">.</span><span class="n">SIZING</span><span class="p">:</span>
                <span class="n">model</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">default_model</span><span class="p">,</span> <span class="n">Mission</span><span class="o">.</span><span class="n">Objectives</span><span class="o">.</span><span class="n">FUEL</span><span class="p">,</span> <span class="n">default_weight</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">problem_type</span> <span class="ow">is</span> <span class="n">ProblemType</span><span class="o">.</span><span class="n">ALTERNATE</span><span class="p">:</span>
                <span class="n">model</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">default_model</span><span class="p">,</span> <span class="n">Mission</span><span class="o">.</span><span class="n">Objectives</span><span class="o">.</span><span class="n">FUEL</span><span class="p">,</span> <span class="n">default_weight</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">problem_type</span> <span class="ow">is</span> <span class="n">ProblemType</span><span class="o">.</span><span class="n">FALLOUT</span><span class="p">:</span>
                <span class="n">model</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">default_model</span><span class="p">,</span> <span class="n">Mission</span><span class="o">.</span><span class="n">Objectives</span><span class="o">.</span><span class="n">RANGE</span><span class="p">,</span> <span class="n">default_weight</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Unrecognized objective format: </span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s1">. &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;Each argument must be one of the following: &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;(output), (output, weight), (model, output), or (model, output, weight).&#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;Outputs can be from the variable meta data, or can be: fuel_burned, fuel&#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;Or problem type must be set to SIZING, ALTERNATE, or FALLOUT&#39;</span>
                <span class="p">)</span>
            <span class="n">objectives</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">model</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">weight</span><span class="p">))</span>
            <span class="c1"># objectives = [</span>
            <span class="c1"># (&#39;model1&#39;, Mission.Summary.FUEL_BURNED, 1),</span>
            <span class="c1"># (&#39;model2&#39;, Mission.Summary.CO2, 1),</span>
            <span class="c1">#  ...</span>
            <span class="c1"># ]</span>

        <span class="c1"># Dictionary for default reference values</span>
        <span class="n">default_ref_values</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;mass&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">5e4</span><span class="p">,</span>
            <span class="s1">&#39;hybrid_objective&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">5e4</span><span class="p">,</span>
            <span class="s1">&#39;fuel_burned&#39;</span><span class="p">:</span> <span class="mf">1e4</span><span class="p">,</span>
            <span class="s1">&#39;fuel&#39;</span><span class="p">:</span> <span class="mf">1e4</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Now checkout the output and see if we have recognizable strings and replace them with the variable meta data name</span>
        <span class="n">objectives_cleaned</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">objectives</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;fuel_burned&#39;</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">Mission</span><span class="o">.</span><span class="n">Summary</span><span class="o">.</span><span class="n">FUEL_BURNED</span>
                <span class="c1"># default scaling is valid only if this is the only argument and the ref has not yet been set</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">ref</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># set a default ref</span>
                    <span class="n">ref</span> <span class="o">=</span> <span class="n">default_ref_values</span><span class="p">[</span><span class="s1">&#39;fuel_burned&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;fuel&#39;</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">Mission</span><span class="o">.</span><span class="n">Objectives</span><span class="o">.</span><span class="n">FUEL</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">ref</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ref</span> <span class="o">=</span> <span class="n">default_ref_values</span><span class="p">[</span><span class="s1">&#39;fuel&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;mass&#39;</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">Mission</span><span class="o">.</span><span class="n">Summary</span><span class="o">.</span><span class="n">FINAL_MASS</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">ref</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ref</span> <span class="o">=</span> <span class="n">default_ref_values</span><span class="p">[</span><span class="s1">&#39;mass&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">Mission</span><span class="o">.</span><span class="n">Summary</span><span class="o">.</span><span class="n">FINAL_TIME</span>
            <span class="k">elif</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;range&#39;</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">Mission</span><span class="o">.</span><span class="n">Summary</span><span class="o">.</span><span class="n">RANGE</span>  <span class="c1"># Unsure if this will work</span>
            <span class="n">objectives_cleaned</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">model</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">weight</span><span class="p">))</span>

        <span class="c1"># Create the calculation string for the ExecComp() and the promotion reference values</span>
        <span class="n">weighted_exprs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">connection_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">obj_inputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">total_weight</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">weight</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">objectives_cleaned</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">objectives_cleaned</span><span class="p">:</span>
            <span class="n">output_safe</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>

            <span class="c1"># we use &quot;_&quot; here because ExecComp() cannot intake &quot;.&quot;</span>
            <span class="n">obj_input</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">output_safe</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">obj_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj_input</span><span class="p">)</span>
            <span class="n">weighted_exprs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">obj_input</span><span class="si">}</span><span class="s1">*</span><span class="si">{</span><span class="n">weight</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">total_weight</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">connection_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;composite_function.</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">output_safe</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="n">final_expr</span> <span class="o">=</span> <span class="s1">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">weighted_exprs</span><span class="p">)</span>

        <span class="c1"># weighted_str looks like:  &#39;model1_fuelburn*0.67*0.5 + model1_gross_mass*0.33*0.5 + model2_fuelburn*0.67*0.5 + model2_gross_mass*0.33*0.5&#39;</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">openmdao</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;3.40&#39;</span><span class="p">):</span>
            <span class="c1"># We can get the correct unit from the source. This prevents a warning.</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;units_by_conn&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">obj_inputs</span><span class="p">}</span>

        <span class="c1"># adding composite execComp to super problem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span>
            <span class="s1">&#39;composite_function&#39;</span><span class="p">,</span>
            <span class="n">om</span><span class="o">.</span><span class="n">ExecComp</span><span class="p">(</span><span class="s1">&#39;composite_objective = &#39;</span> <span class="o">+</span> <span class="n">final_expr</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="n">promotes_outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;composite_objective&#39;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="c1"># connect from inside of the models to the composite objective</span>
        <span class="k">for</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">connection_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
        <span class="c1"># finally add the objective</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span><span class="s1">&#39;composite_objective&#39;</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">ref</span><span class="p">)</span></div>


<div class="viewcode-block" id="AviaryProblem.add_composite_objective_adv">
<a class="viewcode-back" href="../../../_srcdocs/packages/interface/methods_for_level2.html#aviary.interface.methods_for_level2.AviaryProblem.add_composite_objective_adv">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_composite_objective_adv</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">missions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">outputs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">mission_weights</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">output_weights</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ref</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a composite objective function to the OpenMDAO problem by aggregating output values across</span>
<span class="sd">        multiple mission models, with independent weighting for both missions and outputs. This is most</span>
<span class="sd">        useful when you have historical information on how often a given mission was flown (mission_weights)</span>
<span class="sd">        and then you have a duel set of objectives you wish to include i.e. for each flight minimize</span>
<span class="sd">        both fuel_burned and gross_mass. How important fuel_burned is vs. gross_mass is determined via</span>
<span class="sd">        specifying output_weights.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        missions : list of str</span>
<span class="sd">            List of subsystem names (e.g., &#39;model1&#39;, &#39;model2&#39;) corresponding to different missions.</span>

<span class="sd">        outputs : list of str</span>
<span class="sd">            List of output variable names (e.g., Mission.Summary.FUEL_BURNED, Mission.Summary.GROSS_MASS) to be included</span>
<span class="sd">            in the objective from each mission.</span>

<span class="sd">        mission_weights : list of float, optional</span>
<span class="sd">            Weights assigned to each mission. If None, equal weighting is assumed.</span>
<span class="sd">            These weights will be normalized internally to sum to 1.0.</span>

<span class="sd">        output_weights : list of float, optional</span>
<span class="sd">            Weights assigned to each output variable. If None, equal weighting is assumed.</span>
<span class="sd">            These weights will also be normalized internally to sum to 1.0.</span>

<span class="sd">        ref : float, optional</span>
<span class="sd">            Reference value for the final objective. Passed to `add_objective()` for scaling.</span>

<span class="sd">        Behavior</span>
<span class="sd">        --------</span>
<span class="sd">        - Connects each specified mission output into a newly created `ExecComp` block.</span>
<span class="sd">        - Computes a weighted sum: each output is weighted by both its output weight</span>
<span class="sd">        and the weight of the mission it came from.</span>
<span class="sd">        - Adds the result as the final objective named `&#39;composite_objective&#39;`, accessible at the top level model.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Setup mission and output lengths if they are not already given</span>
        <span class="k">if</span> <span class="n">mission_weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mission_weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">missions</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">output_weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">output_weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">outputs</span><span class="p">))</span>

        <span class="c1"># # Make an ExecComp</span>
        <span class="c1"># for mission in missions:</span>
        <span class="c1">#     for output in outputs:</span>

        <span class="c1"># weights are normalized - e.g. for given weights 3:1, the normalized</span>
        <span class="c1"># weights are 0.75:0.25</span>
        <span class="c1"># TODO: Remove before push</span>
        <span class="c1"># output_weights = [2,1]</span>
        <span class="c1"># mission_weights = [1,1]</span>
        <span class="c1"># missions = [&#39;model1&#39;,&#39;model2&#39;]</span>
        <span class="c1"># outputs = [&#39;fuelburn&#39;,&#39;gross_mass&#39;]</span>
        <span class="n">weighted_exprs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">connection_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">output_weights</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">weight</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">output_weights</span><span class="p">))</span> <span class="k">for</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">output_weights</span><span class="p">]</span>
        <span class="n">mission_weights</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">weight</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">mission_weights</span><span class="p">))</span> <span class="k">for</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">mission_weights</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">mission</span><span class="p">,</span> <span class="n">mission_weight</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">missions</span><span class="p">,</span> <span class="n">mission_weights</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">output</span><span class="p">,</span> <span class="n">output_weight</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">output_weights</span><span class="p">):</span>
                <span class="n">connection_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;composite_function.</span><span class="si">{</span><span class="n">mission</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">mission</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">weighted_exprs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">mission</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s1">*</span><span class="si">{</span><span class="n">output_weight</span><span class="si">}</span><span class="s1">*</span><span class="si">{</span><span class="n">mission_weight</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">final_expr</span> <span class="o">=</span> <span class="s1">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">weighted_exprs</span><span class="p">)</span>
        <span class="c1"># weighted_str looks like:  &#39;model1.fuelburn*0.67*0.5 + model1.gross_mass*0.33*0.5 + model2.fuelburn*0.67*0.5 + model2.gross_mass*0.33*0.5&#39;</span>

        <span class="c1"># adding composite execComp to super problem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span>
            <span class="s1">&#39;composite_function&#39;</span><span class="p">,</span>
            <span class="n">om</span><span class="o">.</span><span class="n">ExecComp</span><span class="p">(</span><span class="s1">&#39;composite_objective = &#39;</span> <span class="o">+</span> <span class="n">final_expr</span><span class="p">,</span> <span class="n">has_diag_partials</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">promotes_outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;composite_objective&#39;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="c1"># connect from inside of the models to the composite objective</span>
        <span class="k">for</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">connection_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="c1"># finally add the objective</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span><span class="s1">&#39;composite_objective&#39;</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">ref</span><span class="p">)</span></div>


<div class="viewcode-block" id="AviaryProblem.build_model">
<a class="viewcode-back" href="../../../_srcdocs/packages/interface/methods_for_level2.html#aviary.interface.methods_for_level2.AviaryProblem.build_model">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">build_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A lightly wrapped add_pre_mission_systems(), add_phases(), add_post_mission_systems(), and link_phases()</span>
<span class="sd">        method to decrease code length for the avarage user. If the user needs finer control, they should</span>
<span class="sd">        not use build_model but instead call the four individual methods separately.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        verbosity : Verbosity or int, optional</span>
<span class="sd">            Controls the level of printouts for this method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># `self.verbosity` is &quot;true&quot; verbosity for entire run. `verbosity` is verbosity</span>
        <span class="c1"># override for just this method</span>
        <span class="k">if</span> <span class="n">verbosity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># compatibility with being passed int for verbosity</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="n">Verbosity</span><span class="p">(</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span>  <span class="c1"># defaults to BRIEF</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem_type</span> <span class="o">==</span> <span class="n">ProblemType</span><span class="o">.</span><span class="n">MULTI_MISSION</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aviary_groups_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">group</span><span class="o">.</span><span class="n">add_pre_mission_systems</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
                <span class="n">group</span><span class="o">.</span><span class="n">add_phases</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span> <span class="n">comm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="p">)</span>
                <span class="n">group</span><span class="o">.</span><span class="n">add_post_mission_systems</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
                <span class="n">group</span><span class="o">.</span><span class="n">link_phases</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span> <span class="n">comm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_pre_mission_systems</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_phases</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span> <span class="n">comm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_post_mission_systems</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">link_phases</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span> <span class="n">comm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="p">)</span></div>


<div class="viewcode-block" id="AviaryProblem.promote_inputs">
<a class="viewcode-back" href="../../../_srcdocs/packages/interface/methods_for_level2.html#aviary.interface.methods_for_level2.AviaryProblem.promote_inputs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">promote_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mission_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">var_pairs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Link a promoted input to multiple groups&#39; unpromoted inputs using an internal IVC.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        self : om.Problem</span>
<span class="sd">            The Problem instance this is being called from.</span>

<span class="sd">        missions : list of str</span>
<span class="sd">            The subsystem names receiving the connection.</span>

<span class="sd">        var_pairs : list of (str, str)</span>
<span class="sd">            Each pair is (input_name_in_group, top_level_name_to_use)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aviary_groups_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">mission_name</span> <span class="ow">in</span> <span class="n">mission_names</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">mission_name</span><span class="p">:</span>
                    <span class="c1"># the group name matches the mission name,</span>
                    <span class="c1"># group.promotes(var_pairs)</span>
                    <span class="c1"># print(&quot;var_pairs&quot;,var_pairs)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">promotes</span><span class="p">(</span><span class="n">mission_name</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">var_pairs</span><span class="p">)</span></div>


<div class="viewcode-block" id="AviaryProblem.setup">
<a class="viewcode-back" href="../../../_srcdocs/packages/interface/methods_for_level2.html#aviary.interface.methods_for_level2.AviaryProblem.setup">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A lightly wrapped setup() and set_initial_defaults() method for the problem.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        verbosity : Verbosity or int, optional</span>
<span class="sd">            Controls the level of printouts for this method.</span>
<span class="sd">        **kwargs : optional</span>
<span class="sd">            All arguments to be passed to the OpenMDAO prob.setup() method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># verbosity is not used in this method, but it is understandable that a user</span>
        <span class="c1"># might try and include it (only method that doesn&#39;t accept it). Capture it</span>
        <span class="k">if</span> <span class="s1">&#39;verbosity&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;verbosity&#39;</span><span class="p">)</span>
        <span class="c1"># Use OpenMDAO&#39;s model options to pass all options through the system hierarchy.</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem_type</span> <span class="o">==</span> <span class="n">ProblemType</span><span class="o">.</span><span class="n">MULTI_MISSION</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aviary_groups_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">setup_model_options</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="o">.</span><span class="n">aviary_inputs</span><span class="p">,</span> <span class="n">group</span><span class="o">.</span><span class="n">meta_data</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">group</span>
                <span class="p">)</span>
                <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                    <span class="c1"># group.aviary_inputs is already set</span>
                    <span class="n">group</span><span class="o">.</span><span class="n">meta_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_data</span>  <span class="c1"># &lt;- meta_data is the same for all groups</span>
                    <span class="c1"># group.phase_info is already set</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">setup_model_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">aviary_inputs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_data</span><span class="p">)</span>
            <span class="c1"># suppress warnings:</span>
            <span class="c1"># &quot;input variable &#39;...&#39; promoted using &#39;*&#39; was already promoted using &#39;aircraft:*&#39;</span>
            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">aviary_inputs</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">aviary_inputs</span>
                <span class="p">)</span>  <span class="c1"># &lt;- there is only one aviary_inputs in this case</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">meta_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_data</span>
                <span class="c1"># self.model.phase_info is already set</span>

        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">om</span><span class="o">.</span><span class="n">OpenMDAOWarning</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">om</span><span class="o">.</span><span class="n">PromotionWarning</span><span class="p">)</span>

            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_initial_guesses</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="AviaryProblem.set_initial_guesses">
<a class="viewcode-back" href="../../../_srcdocs/packages/interface/methods_for_level2.html#aviary.interface.methods_for_level2.AviaryProblem.set_initial_guesses">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_initial_guesses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_prob</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parent_prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call `set_val` on the trajectory for states and controls to seed the problem with</span>
<span class="sd">        reasonable initial guesses. This is especially important for collocation methods.</span>

<span class="sd">        This method first identifies all phases in the trajectory then loops over each phase.</span>
<span class="sd">        Specific initial guesses are added depending on the phase and mission method. Cruise is</span>
<span class="sd">        treated as a special phase for GASP-based missions because it is an AnalyticPhase in</span>
<span class="sd">        Dymos. For this phase, we handle the initial guesses first separately and continue to the</span>
<span class="sd">        next phase after that. For other phases, we set the initial guesses for states and</span>
<span class="sd">        controls according to the information available in the &#39;initial_guesses&#39; attribute of the</span>
<span class="sd">        phase.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># `self.verbosity` is &quot;true&quot; verbosity for entire run. `verbosity` is verbosity</span>
        <span class="c1"># override for just this method</span>
        <span class="k">if</span> <span class="n">verbosity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># compatibility with being passed int for verbosity</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="n">Verbosity</span><span class="p">(</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span>  <span class="c1"># defaults to BRIEF</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem_type</span> <span class="o">==</span> <span class="n">ProblemType</span><span class="o">.</span><span class="n">MULTI_MISSION</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aviary_groups_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">group</span><span class="o">.</span><span class="n">set_initial_guesses</span><span class="p">(</span>
                    <span class="n">parent_prob</span><span class="o">=</span><span class="n">parent_prob</span><span class="p">,</span>
                    <span class="n">parent_prefix</span><span class="o">=</span><span class="n">parent_prefix</span><span class="p">,</span>
                    <span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">set_initial_guesses</span><span class="p">(</span>
                <span class="n">parent_prob</span><span class="o">=</span><span class="n">parent_prob</span><span class="p">,</span>
                <span class="n">parent_prefix</span><span class="o">=</span><span class="n">parent_prefix</span><span class="p">,</span>
                <span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="AviaryProblem.run_aviary_problem">
<a class="viewcode-back" href="../../../_srcdocs/packages/interface/methods_for_level2.html#aviary.interface.methods_for_level2.AviaryProblem.run_aviary_problem">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run_aviary_problem</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">restart_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">suppress_solver_print</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">run_driver</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">simulate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">make_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbosity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function actually runs the Aviary problem, which could be a simulation,</span>
<span class="sd">        optimization, or a driver execution, depending on the arguments provided.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        restart_filename : str, optional</span>
<span class="sd">            The name of the file that contains previously computed solutions which are</span>
<span class="sd">            to be used as starting points for this run. If it is None (default), no</span>
<span class="sd">            restart file will be used.</span>
<span class="sd">        suppress_solver_print : bool, optional</span>
<span class="sd">            If True (default), all solvers&#39; print statements will be suppressed. Useful</span>
<span class="sd">            for deeply nested models with multiple solvers so the print statements don&#39;t</span>
<span class="sd">            overwhelm the output.</span>
<span class="sd">        run_driver : bool, optional</span>
<span class="sd">            If True (default), the driver (aka optimizer) will be executed. If False,</span>
<span class="sd">            the problem will be run through one pass -- equivalent to OpenMDAO&#39;s</span>
<span class="sd">            `run_model` behavior.</span>
<span class="sd">        simulate : bool, optional</span>
<span class="sd">            If True, an explicit Dymos simulation will be performed. The default is</span>
<span class="sd">            False.</span>
<span class="sd">        make_plots : bool, optional</span>
<span class="sd">            If True (default), Dymos html plots will be generated as part of the output.</span>
<span class="sd">        verbosity : Verbosity or int, optional</span>
<span class="sd">            Controls the level of printouts for this method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># `self.verbosity` is &quot;true&quot; verbosity for entire run. `verbosity` is verbosity</span>
        <span class="c1"># override for just this method</span>
        <span class="k">if</span> <span class="n">verbosity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># compatibility with being passed int for verbosity</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="n">Verbosity</span><span class="p">(</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span>  <span class="c1"># defaults to BRIEF</span>

        <span class="k">if</span> <span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="n">Verbosity</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>  <span class="c1"># VERBOSE, DEBUG</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">final_setup</span><span class="p">()</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_reports_dir</span><span class="p">()</span> <span class="o">/</span> <span class="s1">&#39;input_list.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">list_inputs</span><span class="p">(</span><span class="n">out_stream</span><span class="o">=</span><span class="n">outfile</span><span class="p">)</span>

            <span class="n">recorder</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">SqliteRecorder</span><span class="p">(</span><span class="s1">&#39;optimization_history.db&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_recorder</span><span class="p">(</span><span class="n">recorder</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">suppress_solver_print</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_solver_print</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># and run mission, and dynamics</span>
        <span class="k">if</span> <span class="n">run_driver</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">run_problem</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="n">run_driver</span><span class="o">=</span><span class="n">run_driver</span><span class="p">,</span>
                <span class="n">simulate</span><span class="o">=</span><span class="n">simulate</span><span class="p">,</span>
                <span class="n">make_plots</span><span class="o">=</span><span class="n">make_plots</span><span class="p">,</span>
                <span class="n">solution_record_file</span><span class="o">=</span><span class="s1">&#39;problem_history.db&#39;</span><span class="p">,</span>
                <span class="n">restart</span><span class="o">=</span><span class="n">restart_filename</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Manually print out a failure message for low verbosity modes that suppress</span>
            <span class="c1"># optimizer printouts, which may include the results message. Assumes success,</span>
            <span class="c1"># alerts user on a failure</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="ow">and</span> <span class="n">verbosity</span> <span class="o">&lt;=</span> <span class="n">Verbosity</span><span class="o">.</span><span class="n">BRIEF</span>  <span class="c1"># QUIET, BRIEF</span>
            <span class="p">):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Aviary run failed. See the dashboard for more details.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_model</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">result</span>

        <span class="c1"># update n2 diagram after run.</span>
        <span class="n">outdir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_reports_dir</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="s1">&#39;n2.html&#39;</span><span class="p">)</span>
        <span class="n">om</span><span class="o">.</span><span class="n">n2</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">outfile</span><span class="o">=</span><span class="n">outfile</span><span class="p">,</span>
            <span class="n">show_browser</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="n">Verbosity</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>  <span class="c1"># VERBOSE, DEBUG</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_reports_dir</span><span class="p">())</span> <span class="o">/</span> <span class="s1">&#39;output_list.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">(</span><span class="n">out_stream</span><span class="o">=</span><span class="n">outfile</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_payload_range</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_payload_range</span><span class="p">()</span></div>


<div class="viewcode-block" id="AviaryProblem.run_off_design_mission">
<a class="viewcode-back" href="../../../_srcdocs/packages/interface/methods_for_level2.html#aviary.interface.methods_for_level2.AviaryProblem.run_off_design_mission">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run_off_design_mission</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">problem_type</span><span class="p">:</span> <span class="n">ProblemType</span><span class="p">,</span>
        <span class="n">phase_info</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">equations_of_motion</span><span class="p">:</span> <span class="n">EquationsOfMotion</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">problem_configurator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">num_first_class</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">num_business</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">num_economy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">num_pax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">wing_cargo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">misc_cargo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">cargo_mass</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">mission_gross_mass</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">mission_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">optimizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">fill_cargo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fill_fuel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">verbosity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs the aircraft model in a off-design mission of the specified type. It is assumed that</span>
<span class="sd">        the AviaryProblem is loaded with an already sized aircraft.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        problem_type : str, ProblemType</span>
<span class="sd">            The type of off-design mission to be flown. SIZING missions are not allowed.</span>
<span class="sd">        phase_info : dict, optional</span>
<span class="sd">            The phase_info to use for the off-design mission. If not provided, the phase info used</span>
<span class="sd">            for the previous Aviary run (typically the design mission) is used.</span>
<span class="sd">        equation_of_motion : (str, EquationsOfMotion), optional</span>
<span class="sd">            Which equations of motion to use for the off-design mission. If not provided, the</span>
<span class="sd">            equations of motion used for the previous Aviary run (typically the design mission) is</span>
<span class="sd">            used.</span>
<span class="sd">        problem_configurator : ProblemConfigurator, optional</span>
<span class="sd">            Problem configurator to use for the off-design mission. If not provided, the problem</span>
<span class="sd">            configurator used for the previous Aviary run (typically the design mission) is used.</span>
<span class="sd">        num_first_class : int, optional</span>
<span class="sd">            [FLOPS mass only] Number of first-class passengers flying on the off-design mission.</span>
<span class="sd">        num_business : int, optional</span>
<span class="sd">            [FLOPS mass only] Number of business-class passengers flying on the off-design mission.</span>
<span class="sd">        num_economy : int, optional</span>
<span class="sd">            [FLOPS mass only] Number of economy-class passengers flying on the off-design mission.</span>
<span class="sd">        num_pax : int, optional</span>
<span class="sd">            Total number of passengers flying on the off-design mission. Optional if using</span>
<span class="sd">            FLOPS-based mass and passengers per class are defined instead.</span>
<span class="sd">        wing_cargo : float, optional</span>
<span class="sd">            [FLOPS mass only] Mass of wing cargo flying on off-design mission, in pounds-mass.</span>
<span class="sd">        misc_cargo : float, optional</span>
<span class="sd">            [FLOPS mass only] Mass of miscellaneous cargo flying on off-design mission, in</span>
<span class="sd">            pounds-mass.</span>
<span class="sd">        cargo_mass : float, optional</span>
<span class="sd">            Total cargo mass flying on off-design mission, in pounds-mass. Optional if using FLOPS-</span>
<span class="sd">            based mass, individual wing and/or misc cargo is defined, and no additional cargo is</span>
<span class="sd">            being carried elsewhere. Note: if using FLOPS-based mass, this variable is an override</span>
<span class="sd">            for total cargo mass.</span>
<span class="sd">        mission_gross_mass : float, optional</span>
<span class="sd">            Gross mass of aircraft flying off-design mission, in pounds-mass. Defaults to design</span>
<span class="sd">            gross mass. For missions where mass is solved for (such as ALTERNATE missions), this is</span>
<span class="sd">            the initial guess.</span>
<span class="sd">        mission_range : float, optional</span>
<span class="sd">            [ALTERNATE missions only]</span>
<span class="sd">            Sets fixed range of flown off-design mission, in nautical miles. Unused for other</span>
<span class="sd">            mission types.</span>
<span class="sd">        optimizer : string, optional</span>
<span class="sd">            Set which optimizer to use for the off-design mission. If not provided, the optimizer</span>
<span class="sd">            used for the previously ran sizing mission is used. If that cannot be found, such as</span>
<span class="sd">            when a problem is loaded from a json output file, then the default optimizer (SLSQP)</span>
<span class="sd">            is chosen.</span>
<span class="sd">        name : str, optional</span>
<span class="sd">            Name of the off-design problem. Defaults to &quot;{original problem name}_off_design&quot;.</span>
<span class="sd">        fill_cargo : bool, optional</span>
<span class="sd">            Adds a design variable to vary cargo mass to exactly fill the aircraft to design</span>
<span class="sd">            takeoff gross weight. Useful for cases where precise cargo mass required is not known,</span>
<span class="sd">            or when operating mass can change between missions. Defaults to False. Cannot be used at</span>
<span class="sd">            the same time as fill_fuel.</span>
<span class="sd">        fill_fuel : bool, optional</span>
<span class="sd">            Adds takeoff gross mass as a design variable. Useful for cases when operating mass can</span>
<span class="sd">            change between missions. Defaults to False. Cannot be used at the same time as</span>
<span class="sd">            fill_cargo.</span>
<span class="sd">        verbosity : (int, Verbosity), optional</span>
<span class="sd">            Sets the printout level for the entire off-design problem that is ran.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># For off-design missions, provided verbosity will be used for all L2 method calls</span>
        <span class="k">if</span> <span class="n">verbosity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># compatibility with being passed int for verbosity</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="n">Verbosity</span><span class="p">(</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span>  <span class="c1"># defaults to BRIEF</span>

        <span class="c1"># accept str for problem type</span>
        <span class="n">problem_type</span> <span class="o">=</span> <span class="n">ProblemType</span><span class="p">(</span><span class="n">problem_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">problem_type</span> <span class="ow">is</span> <span class="n">ProblemType</span><span class="o">.</span><span class="n">SIZING</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">UserWarning</span><span class="p">(</span><span class="s1">&#39;Off-design missions cannot be SIZING missions.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fill_cargo</span> <span class="ow">and</span> <span class="n">fill_fuel</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">UserWarning</span><span class="p">(</span>
                <span class="s1">&#39;Cannot run an off-design mission with both &quot;fill_cargo&quot; and &quot;fill_fuel&quot; flags &#39;</span>
                <span class="s1">&#39;active.&#39;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">+</span> <span class="s1">&#39;_off_design&#39;</span>
        <span class="n">off_design_prob</span> <span class="o">=</span> <span class="n">AviaryProblem</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Set up problem for mission, such as equations of motion, configurators, etc.</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aviary_inputs</span><span class="p">)</span>

        <span class="n">design_gross_mass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Mission</span><span class="o">.</span><span class="n">Design</span><span class="o">.</span><span class="n">GROSS_MASS</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;lbm&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">inputs</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">Mission</span><span class="o">.</span><span class="n">Design</span><span class="o">.</span><span class="n">GROSS_MASS</span><span class="p">,</span> <span class="n">design_gross_mass</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;lbm&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">problem_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">inputs</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">PROBLEM_TYPE</span><span class="p">,</span> <span class="n">problem_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">equations_of_motion</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">inputs</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">EQUATIONS_OF_MOTION</span><span class="p">,</span> <span class="n">equations_of_motion</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">problem_configurator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">off_design_prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">configurator</span> <span class="o">=</span> <span class="n">problem_configurator</span>

        <span class="k">if</span> <span class="n">phase_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># model phase_info only contains mission information, recreate the whole thing here</span>
            <span class="n">phase_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mission_info</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">phase_info</span><span class="p">[</span><span class="s1">&#39;pre_mission&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">pre_mission_info</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">phase_info</span><span class="p">[</span><span class="s1">&#39;post_mission&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">post_mission_info</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># update passenger count and cargo masses</span>
        <span class="n">mass_method</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">MASS_METHOD</span><span class="p">)</span>

        <span class="c1"># Sanity check passenger counts - cover specific edge case that preprocessors won&#39;t catch</span>
        <span class="c1"># Since we inherit mission pax count from sizing mission, we need to overwrite it</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">mass_method</span> <span class="ow">is</span> <span class="n">FLOPS</span>
            <span class="ow">and</span> <span class="n">num_pax</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">((</span><span class="n">num_economy</span><span class="p">,</span> <span class="n">num_business</span><span class="p">,</span> <span class="n">num_first_class</span><span class="p">))</span>
        <span class="p">):</span>
            <span class="n">num_pax</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="n">num_economy</span><span class="p">,</span> <span class="n">num_business</span><span class="p">,</span> <span class="n">num_first_class</span><span class="p">]))</span>

        <span class="c1"># only FLOPS cares about seat class or specific cargo categories</span>
        <span class="k">if</span> <span class="n">mass_method</span> <span class="o">==</span> <span class="n">LegacyCode</span><span class="o">.</span><span class="n">FLOPS</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">num_first_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">inputs</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">Aircraft</span><span class="o">.</span><span class="n">CrewPayload</span><span class="o">.</span><span class="n">NUM_FIRST_CLASS</span><span class="p">,</span> <span class="n">num_first_class</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">num_business</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">inputs</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">Aircraft</span><span class="o">.</span><span class="n">CrewPayload</span><span class="o">.</span><span class="n">NUM_BUSINESS_CLASS</span><span class="p">,</span> <span class="n">num_business</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">num_economy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">inputs</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">Aircraft</span><span class="o">.</span><span class="n">CrewPayload</span><span class="o">.</span><span class="n">NUM_ECONOMY_CLASS</span><span class="p">,</span> <span class="n">num_economy</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">wing_cargo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">inputs</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">Aircraft</span><span class="o">.</span><span class="n">CrewPayload</span><span class="o">.</span><span class="n">WING_CARGO</span><span class="p">,</span> <span class="n">wing_cargo</span><span class="p">,</span> <span class="s1">&#39;lbm&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">misc_cargo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">inputs</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">Aircraft</span><span class="o">.</span><span class="n">CrewPayload</span><span class="o">.</span><span class="n">MISC_CARGO</span><span class="p">,</span> <span class="n">misc_cargo</span><span class="p">,</span> <span class="s1">&#39;lbm&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s1">&#39;Off-design functionality is in beta for GASP-mass based aircraft. Please manually &#39;</span>
                <span class="s1">&#39;verify your results.&#39;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">num_pax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">inputs</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">Aircraft</span><span class="o">.</span><span class="n">CrewPayload</span><span class="o">.</span><span class="n">NUM_PASSENGERS</span><span class="p">,</span> <span class="n">num_pax</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cargo_mass</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">inputs</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">Aircraft</span><span class="o">.</span><span class="n">CrewPayload</span><span class="o">.</span><span class="n">CARGO_MASS</span><span class="p">,</span> <span class="n">cargo_mass</span><span class="p">,</span> <span class="s1">&#39;lbm&#39;</span><span class="p">)</span>

        <span class="c1"># NOTE once load_inputs is run, phase info details are stored in prob.model.configurator,</span>
        <span class="c1">#      meaning any phase_info changes that happen after load inputs is ignored</span>

        <span class="k">if</span> <span class="n">problem_type</span> <span class="ow">is</span> <span class="n">ProblemType</span><span class="o">.</span><span class="n">ALTERNATE</span><span class="p">:</span>
            <span class="c1"># Set mission range, aviary will calculate required fuel</span>
            <span class="k">if</span> <span class="n">mission_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="n">Verbosity</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="s1">&#39;Alternate problem type requested with no specified range. Using design &#39;</span>
                        <span class="s1">&#39;mission range for the off-design mission.&#39;</span>
                    <span class="p">)</span>
                <span class="n">mission_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Mission</span><span class="o">.</span><span class="n">Summary</span><span class="o">.</span><span class="n">RANGE</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;NM&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">phase_info</span><span class="p">[</span><span class="s1">&#39;post_mission&#39;</span><span class="p">][</span><span class="s1">&#39;target_range&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">mission_range</span><span class="p">,</span>
                <span class="s1">&#39;nmi&#39;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># reset the AviaryProblem to run the new mission</span>
        <span class="n">off_design_prob</span><span class="o">.</span><span class="n">load_inputs</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">phase_info</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>

        <span class="c1"># Update inputs that are specific to problem type</span>
        <span class="c1"># Some Alternate problem changes had to happen before load_inputs, all fallout problem</span>
        <span class="c1"># changes must come after load_inputs</span>
        <span class="k">if</span> <span class="n">problem_type</span> <span class="ow">is</span> <span class="n">ProblemType</span><span class="o">.</span><span class="n">ALTERNATE</span><span class="p">:</span>
            <span class="n">off_design_prob</span><span class="o">.</span><span class="n">aviary_inputs</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">Mission</span><span class="o">.</span><span class="n">Summary</span><span class="o">.</span><span class="n">RANGE</span><span class="p">,</span> <span class="n">mission_range</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;NM&#39;</span><span class="p">)</span>
            <span class="c1"># set initial guess for Mission.Summary.GROSS_MASS to help optimizer with new design</span>
            <span class="c1"># variable bounds.</span>
            <span class="k">if</span> <span class="n">mission_gross_mass</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mission_gross_mass</span> <span class="o">=</span> <span class="n">off_design_prob</span><span class="o">.</span><span class="n">aviary_inputs</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span>
                    <span class="n">Mission</span><span class="o">.</span><span class="n">Design</span><span class="o">.</span><span class="n">GROSS_MASS</span><span class="p">,</span> <span class="s1">&#39;lbm&#39;</span>
                <span class="p">)</span>
            <span class="n">off_design_prob</span><span class="o">.</span><span class="n">aviary_inputs</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span>
                <span class="n">Mission</span><span class="o">.</span><span class="n">Summary</span><span class="o">.</span><span class="n">GROSS_MASS</span><span class="p">,</span> <span class="n">mission_gross_mass</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;lbm&#39;</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="n">problem_type</span> <span class="ow">is</span> <span class="n">ProblemType</span><span class="o">.</span><span class="n">FALLOUT</span><span class="p">:</span>
            <span class="c1"># Set mission fuel and calculate gross weight, aviary will calculate range</span>
            <span class="k">if</span> <span class="n">mission_gross_mass</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="n">Verbosity</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="s1">&#39;Fallout problem type requested with no specified gross mass. Using design &#39;</span>
                        <span class="s1">&#39;takeoff gross mass for the off-design mission.&#39;</span>
                    <span class="p">)</span>
                <span class="n">mission_gross_mass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Mission</span><span class="o">.</span><span class="n">Design</span><span class="o">.</span><span class="n">GROSS_MASS</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;lbm&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">off_design_prob</span><span class="o">.</span><span class="n">aviary_inputs</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span>
                <span class="n">Mission</span><span class="o">.</span><span class="n">Summary</span><span class="o">.</span><span class="n">GROSS_MASS</span><span class="p">,</span> <span class="n">mission_gross_mass</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;lbm&#39;</span>
            <span class="p">)</span>

        <span class="n">off_design_prob</span><span class="o">.</span><span class="n">check_and_preprocess_inputs</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="c1"># off_design_prob.add_pre_mission_systems(verbosity=verbosity)</span>
        <span class="c1"># off_design_prob.add_phases(verbosity=verbosity)</span>
        <span class="c1"># off_design_prob.add_post_mission_systems(verbosity=verbosity)</span>
        <span class="c1"># off_design_prob.link_phases(verbosity=verbosity)</span>
        <span class="n">off_design_prob</span><span class="o">.</span><span class="n">build_model</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">optimizer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">optimizer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;optimizer&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">optimizer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">off_design_prob</span><span class="o">.</span><span class="n">add_driver</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="n">off_design_prob</span><span class="o">.</span><span class="n">add_design_variables</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>

        <span class="c1"># Handle edge case for payload-range diagrams</span>
        <span class="c1"># Select which cargo variable makes the most sense to float, and then set a tolerance</span>
        <span class="c1"># based on rough guesses on what is sufficient to get the problem to converge without</span>
        <span class="c1"># setting design variable bounds too large</span>
        <span class="k">if</span> <span class="n">fill_cargo</span><span class="p">:</span>
            <span class="c1"># GASP cargo mass is an input, can directly use as control variable</span>
            <span class="k">if</span> <span class="n">mass_method</span> <span class="ow">is</span> <span class="n">GASP</span><span class="p">:</span>
                <span class="n">control_var</span> <span class="o">=</span> <span class="n">Aircraft</span><span class="o">.</span><span class="n">CrewPayload</span><span class="o">.</span><span class="n">CARGO_MASS</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">cargo_mass</span>
                <span class="n">tol</span> <span class="o">=</span> <span class="mf">1.05</span>
            <span class="c1"># FLOPS cargo mass is an output, not valid for control variable. Pick control var.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># See if misc_cargo is being used, float that as a backup</span>
                <span class="k">if</span> <span class="n">misc_cargo</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">misc_cargo</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># We aren&#39;t using cargo_mass OR misc_mass - try wing cargo as last resort</span>
                    <span class="k">if</span> <span class="n">wing_cargo</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">wing_cargo</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c1"># We don&#39;t know enough about the aircraft to make any informed guesses. Use</span>
                        <span class="c1"># arbitrary values</span>
                        <span class="n">control_var</span> <span class="o">=</span> <span class="n">Aircraft</span><span class="o">.</span><span class="n">CrewPayload</span><span class="o">.</span><span class="n">MISC_CARGO</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Mission</span><span class="o">.</span><span class="n">Design</span><span class="o">.</span><span class="n">GROSS_MASS</span><span class="p">)</span>
                        <span class="n">tol</span> <span class="o">=</span> <span class="mf">0.05</span>
                        <span class="n">inputs</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">Aircraft</span><span class="o">.</span><span class="n">CrewPayload</span><span class="o">.</span><span class="n">CARGO_MASS</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;lbm&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">control_var</span> <span class="o">=</span> <span class="n">Aircraft</span><span class="o">.</span><span class="n">CrewPayload</span><span class="o">.</span><span class="n">WING_CARGO</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="n">wing_cargo</span>
                        <span class="n">tol</span> <span class="o">=</span> <span class="mf">1.1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">control_var</span> <span class="o">=</span> <span class="n">Aircraft</span><span class="o">.</span><span class="n">CrewPayload</span><span class="o">.</span><span class="n">MISC_CARGO</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">misc_cargo</span>
                    <span class="n">tol</span> <span class="o">=</span> <span class="mf">1.1</span>

            <span class="n">off_design_prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span>
                <span class="n">control_var</span><span class="p">,</span>
                <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">upper</span><span class="o">=</span><span class="n">val</span> <span class="o">*</span> <span class="n">tol</span><span class="p">,</span>
                <span class="n">ref</span><span class="o">=</span><span class="n">val</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">fill_fuel</span><span class="p">:</span>
            <span class="n">off_design_prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span>
                <span class="n">Mission</span><span class="o">.</span><span class="n">Summary</span><span class="o">.</span><span class="n">GROSS_MASS</span><span class="p">,</span>
                <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">upper</span><span class="o">=</span><span class="n">off_design_prob</span><span class="o">.</span><span class="n">aviary_inputs</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Mission</span><span class="o">.</span><span class="n">Design</span><span class="o">.</span><span class="n">GROSS_MASS</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;lbm&#39;</span><span class="p">),</span>
                <span class="n">ref</span><span class="o">=</span><span class="n">off_design_prob</span><span class="o">.</span><span class="n">aviary_inputs</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Mission</span><span class="o">.</span><span class="n">Design</span><span class="o">.</span><span class="n">GROSS_MASS</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;lbm&#39;</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="n">off_design_prob</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="n">off_design_prob</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="n">off_design_prob</span><span class="o">.</span><span class="n">set_initial_guesses</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>

        <span class="n">off_design_prob</span><span class="o">.</span><span class="n">run_aviary_problem</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">off_design_prob</span></div>


<div class="viewcode-block" id="AviaryProblem.run_payload_range">
<a class="viewcode-back" href="../../../_srcdocs/packages/interface/methods_for_level2.html#aviary.interface.methods_for_level2.AviaryProblem.run_payload_range">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run_payload_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function runs Payload/Range analysis for the aircraft model.</span>

<span class="sd">        For an aircraft model that has been sized with a mission has has successfully converged,</span>
<span class="sd">        this function will adjust the given phase information, assuming that there is a phase named</span>
<span class="sd">        &#39;cruise&#39; and elongates the duration bounds to allow the optimizer</span>
<span class="sd">        to converge for the max economic and ferry missions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        verbosity : Verbosity or int (optional)</span>
<span class="sd">            Sets overriding verbosity to be used while running all payload-range points</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        payload_range_problems : tuple</span>
<span class="sd">            Tuple containing the off-design AviaryProblems for the max economic and ferry ranges</span>

<span class="sd">        TODO currently does not account for reserve fuel</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># For off-design missions, provided verbosity will be used for all L2 method calls</span>
        <span class="k">if</span> <span class="n">verbosity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># compatibility with being passed int for verbosity</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="n">Verbosity</span><span class="p">(</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verbosity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span>  <span class="c1"># defaults to BRIEF</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="ow">and</span> <span class="n">verbosity</span> <span class="o">&gt;</span> <span class="n">Verbosity</span><span class="o">.</span><span class="n">QUIET</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s1">&#39;Payload Range Diagrams cannot be generated for unconverged Aviary problems.&#39;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem_type</span> <span class="ow">is</span> <span class="n">ProblemType</span><span class="o">.</span><span class="n">MULTI_MISSION</span> <span class="ow">and</span> <span class="n">verbosity</span> <span class="o">&gt;</span> <span class="n">Verbosity</span><span class="o">.</span><span class="n">QUIET</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s1">&#39;Payload Range Diagrams currently cannot be generated for aircraft designed &#39;</span>
                <span class="s1">&#39;using multimission capability.&#39;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="p">()</span>

        <span class="c1"># Off-design missions are not tested with 2DOF missions.</span>
        <span class="n">mass_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">aviary_inputs</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">MASS_METHOD</span><span class="p">)</span>
        <span class="n">equations_of_motion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">aviary_inputs</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">EQUATIONS_OF_MOTION</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">equations_of_motion</span> <span class="ow">is</span> <span class="n">EquationsOfMotion</span><span class="o">.</span><span class="n">HEIGHT_ENERGY</span><span class="p">:</span>
            <span class="c1"># make a copy of the phase_info to avoid modifying the original.</span>
            <span class="n">phase_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mission_info</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">phase_info</span><span class="p">[</span><span class="s1">&#39;pre_mission&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">pre_mission_info</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">phase_info</span><span class="p">[</span><span class="s1">&#39;post_mission&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">post_mission_info</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="c1"># This checks if the &#39;cruise&#39; phase exists, then automatically extends duration bounds</span>
            <span class="c1"># of the cruise stage to allow for the longer economic and ferry missions.</span>
            <span class="k">if</span> <span class="n">phase_info</span><span class="p">[</span><span class="s1">&#39;cruise&#39;</span><span class="p">]:</span>
                <span class="n">min_duration</span> <span class="o">=</span> <span class="n">phase_info</span><span class="p">[</span><span class="s1">&#39;cruise&#39;</span><span class="p">][</span><span class="s1">&#39;user_options&#39;</span><span class="p">][</span><span class="s1">&#39;time_duration_bounds&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">max_duration</span> <span class="o">=</span> <span class="n">phase_info</span><span class="p">[</span><span class="s1">&#39;cruise&#39;</span><span class="p">][</span><span class="s1">&#39;user_options&#39;</span><span class="p">][</span><span class="s1">&#39;time_duration_bounds&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">cruise_units</span> <span class="o">=</span> <span class="n">phase_info</span><span class="p">[</span><span class="s1">&#39;cruise&#39;</span><span class="p">][</span><span class="s1">&#39;user_options&#39;</span><span class="p">][</span><span class="s1">&#39;time_duration_bounds&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

                <span class="n">phase_info</span><span class="p">[</span><span class="s1">&#39;cruise&#39;</span><span class="p">][</span><span class="s1">&#39;user_options&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="p">{</span><span class="s1">&#39;time_duration_bounds&#39;</span><span class="p">:</span> <span class="p">((</span><span class="n">min_duration</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">max_duration</span><span class="p">),</span> <span class="n">cruise_units</span><span class="p">)}</span>
                <span class="p">)</span>

            <span class="c1"># TODO Verify that previously run point is actually max payload/fuel point, and if not</span>
            <span class="c1">#      run off-design mission for that point</span>
            <span class="c1"># Point 1 is along the y axis (range=0)</span>
            <span class="n">payload_1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Aircraft</span><span class="o">.</span><span class="n">CrewPayload</span><span class="o">.</span><span class="n">TOTAL_PAYLOAD_MASS</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">range_1</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">fuel_1</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># Point 2 (Design Range): sizing mission which is assumed to be the point of max</span>
            <span class="c1"># payload + fuel on the payload and range diagram</span>
            <span class="n">payload_2</span> <span class="o">=</span> <span class="n">payload_1</span>

            <span class="n">range_2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Mission</span><span class="o">.</span><span class="n">Summary</span><span class="o">.</span><span class="n">RANGE</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">gross_mass</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Mission</span><span class="o">.</span><span class="n">Summary</span><span class="o">.</span><span class="n">GROSS_MASS</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1"># NOTE this operating mass is based on the previously run mission - assumed this is the</span>
            <span class="c1"># design mission!! Includes cargo containers needed for design (max payload)</span>
            <span class="n">operating_mass</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Mission</span><span class="o">.</span><span class="n">Summary</span><span class="o">.</span><span class="n">OPERATING_MASS</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">fuel_capacity</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Aircraft</span><span class="o">.</span><span class="n">Fuel</span><span class="o">.</span><span class="n">TOTAL_CAPACITY</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">unusable_fuel</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Aircraft</span><span class="o">.</span><span class="n">Fuel</span><span class="o">.</span><span class="n">UNUSABLE_FUEL_MASS</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">max_payload</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Aircraft</span><span class="o">.</span><span class="n">CrewPayload</span><span class="o">.</span><span class="n">TOTAL_PAYLOAD_MASS</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">fuel_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Mission</span><span class="o">.</span><span class="n">Summary</span><span class="o">.</span><span class="n">FUEL_BURNED</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Operating mass includes unusable fuel, don&#39;t double count</span>
            <span class="n">max_usable_fuel</span> <span class="o">=</span> <span class="n">fuel_capacity</span> <span class="o">-</span> <span class="n">unusable_fuel</span>

            <span class="c1"># An aircraft may be designed with fuel tank capacity that, if fully filled, would</span>
            <span class="c1"># exceed MTOW. In that scenario, Max Economic Range and Ferry Range are the same, and</span>
            <span class="c1"># the point only needs to be run once.</span>
            <span class="k">if</span> <span class="n">operating_mass</span> <span class="o">+</span> <span class="n">max_usable_fuel</span> <span class="o">&lt;</span> <span class="n">gross_mass</span><span class="p">:</span>
                <span class="c1"># Point 3 (Max Economic Range): max fuel and remaining payload capacity</span>
                <span class="c1"># Assume proportional decrease in all cargo types (including number of passengers)</span>
                <span class="c1"># to make room for maximum fuel. Round pax count down to avoid loading over TOGW</span>

                <span class="n">economic_mission_total_payload</span> <span class="o">=</span> <span class="n">gross_mass</span> <span class="o">-</span> <span class="n">operating_mass</span> <span class="o">-</span> <span class="n">max_usable_fuel</span>
                <span class="n">payload_frac</span> <span class="o">=</span> <span class="n">economic_mission_total_payload</span> <span class="o">/</span> <span class="n">max_payload</span>

                <span class="c1"># Calculates Different payload quantities</span>
                <span class="n">economic_mission_wing_cargo</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">aviary_inputs</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Aircraft</span><span class="o">.</span><span class="n">CrewPayload</span><span class="o">.</span><span class="n">WING_CARGO</span><span class="p">,</span> <span class="s1">&#39;lbm&#39;</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">payload_frac</span>
                <span class="p">)</span>
                <span class="n">economic_mission_misc_cargo</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">aviary_inputs</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Aircraft</span><span class="o">.</span><span class="n">CrewPayload</span><span class="o">.</span><span class="n">MISC_CARGO</span><span class="p">,</span> <span class="s1">&#39;lbm&#39;</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">payload_frac</span>
                <span class="p">)</span>
                <span class="n">economic_mission_num_first</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">aviary_inputs</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Aircraft</span><span class="o">.</span><span class="n">CrewPayload</span><span class="o">.</span><span class="n">Design</span><span class="o">.</span><span class="n">NUM_FIRST_CLASS</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">payload_frac</span>
                <span class="p">)</span>
                <span class="n">economic_mission_num_bus</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">aviary_inputs</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Aircraft</span><span class="o">.</span><span class="n">CrewPayload</span><span class="o">.</span><span class="n">Design</span><span class="o">.</span><span class="n">NUM_BUSINESS_CLASS</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">payload_frac</span>
                <span class="p">)</span>
                <span class="n">economic_mission_num_economy</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">aviary_inputs</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Aircraft</span><span class="o">.</span><span class="n">CrewPayload</span><span class="o">.</span><span class="n">Design</span><span class="o">.</span><span class="n">NUM_ECONOMY_CLASS</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">payload_frac</span>
                <span class="p">)</span>

                <span class="c1"># Passenger number rounding and potentially cargo container mass changing means</span>
                <span class="c1"># we don&#39;t know if we actually filled the aircraft to exactly TOGW yet. Need to use</span>
                <span class="c1"># &quot;fill_cargo&quot; flag in off-design call</span>
                <span class="n">economic_range_prob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_off_design_mission</span><span class="p">(</span>
                    <span class="n">problem_type</span><span class="o">=</span><span class="n">ProblemType</span><span class="o">.</span><span class="n">FALLOUT</span><span class="p">,</span>
                    <span class="n">phase_info</span><span class="o">=</span><span class="n">phase_info</span><span class="p">,</span>
                    <span class="n">num_first_class</span><span class="o">=</span><span class="n">economic_mission_num_first</span><span class="p">,</span>
                    <span class="n">num_business</span><span class="o">=</span><span class="n">economic_mission_num_bus</span><span class="p">,</span>
                    <span class="n">num_economy</span><span class="o">=</span><span class="n">economic_mission_num_economy</span><span class="p">,</span>
                    <span class="n">wing_cargo</span><span class="o">=</span><span class="n">economic_mission_wing_cargo</span><span class="p">,</span>
                    <span class="n">misc_cargo</span><span class="o">=</span><span class="n">economic_mission_misc_cargo</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">+</span> <span class="s1">&#39;_max_economic_range&#39;</span><span class="p">,</span>
                    <span class="n">fill_cargo</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Pull the payload and range values from the fallout mission</span>
                <span class="n">payload_3</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                    <span class="n">economic_range_prob</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Aircraft</span><span class="o">.</span><span class="n">CrewPayload</span><span class="o">.</span><span class="n">TOTAL_PAYLOAD_MASS</span><span class="p">)</span>
                <span class="p">)</span>

                <span class="n">range_3</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">economic_range_prob</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Mission</span><span class="o">.</span><span class="n">Summary</span><span class="o">.</span><span class="n">RANGE</span><span class="p">))</span>
                <span class="n">fuel_3</span> <span class="o">=</span> <span class="n">economic_range_prob</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Mission</span><span class="o">.</span><span class="n">Summary</span><span class="o">.</span><span class="n">FUEL_BURNED</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">prob_3_skip</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">prob_3_skip</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="c1"># only fill fuel until hit TOGW</span>
                <span class="n">max_usable_fuel</span> <span class="o">=</span> <span class="n">gross_mass</span> <span class="o">-</span> <span class="n">operating_mass</span>

            <span class="c1"># Point 4 (Ferry Range): maximum fuel and 0 payload</span>
            <span class="c1"># Total cargo mass is an input in GASP, but an output in FLOPS. Avoid overriding cargo</span>
            <span class="c1"># mass to 0 if not using GASP</span>
            <span class="k">if</span> <span class="n">mass_method</span> <span class="ow">is</span> <span class="n">GASP</span><span class="p">:</span>
                <span class="n">ferry_cargo_mass</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ferry_cargo_mass</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">ferry_range_gross_mass</span> <span class="o">=</span> <span class="n">operating_mass</span> <span class="o">+</span> <span class="n">max_usable_fuel</span>
            <span class="n">ferry_range_prob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_off_design_mission</span><span class="p">(</span>
                <span class="n">problem_type</span><span class="o">=</span><span class="n">ProblemType</span><span class="o">.</span><span class="n">FALLOUT</span><span class="p">,</span>
                <span class="n">phase_info</span><span class="o">=</span><span class="n">phase_info</span><span class="p">,</span>
                <span class="n">num_first_class</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">num_business</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">num_economy</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">wing_cargo</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">misc_cargo</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">cargo_mass</span><span class="o">=</span><span class="n">ferry_cargo_mass</span><span class="p">,</span>
                <span class="n">mission_gross_mass</span><span class="o">=</span><span class="n">ferry_range_gross_mass</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">+</span> <span class="s1">&#39;_ferry_range&#39;</span><span class="p">,</span>
                <span class="n">fill_fuel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">payload_4</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ferry_range_prob</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Aircraft</span><span class="o">.</span><span class="n">CrewPayload</span><span class="o">.</span><span class="n">TOTAL_PAYLOAD_MASS</span><span class="p">))</span>
            <span class="n">range_4</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ferry_range_prob</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Mission</span><span class="o">.</span><span class="n">Summary</span><span class="o">.</span><span class="n">RANGE</span><span class="p">))</span>
            <span class="n">fuel_4</span> <span class="o">=</span> <span class="n">ferry_range_prob</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Mission</span><span class="o">.</span><span class="n">Summary</span><span class="o">.</span><span class="n">FUEL_BURNED</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># if economic mission was skipped, economic_range_prob is the same as ferry_range_prob</span>
            <span class="k">if</span> <span class="n">prob_3_skip</span><span class="p">:</span>
                <span class="n">economic_range_prob</span> <span class="o">=</span> <span class="n">ferry_range_prob</span>
                <span class="n">payload_3</span> <span class="o">=</span> <span class="n">payload_4</span>
                <span class="n">range_3</span> <span class="o">=</span> <span class="n">range_4</span>

            <span class="c1"># Check if fallout missions ran successfully before writing to csv file</span>
            <span class="c1"># If both missions ran successfully, writes the payload/range data to a csv file</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">payload_range_data</span> <span class="o">=</span> <span class="n">payload_range_data</span> <span class="o">=</span> <span class="n">NamedValues</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">ferry_range_prob</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="ow">and</span> <span class="n">economic_range_prob</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                <span class="n">payload_range_data</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span>
                    <span class="s1">&#39;Mission Name&#39;</span><span class="p">,</span>
                    <span class="p">[</span><span class="s1">&#39;Zero Fuel&#39;</span><span class="p">,</span> <span class="s1">&#39;Design Mission&#39;</span><span class="p">,</span> <span class="s1">&#39;Max Economic Mission&#39;</span><span class="p">,</span> <span class="s1">&#39;Ferry Mission&#39;</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">payload_range_data</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span>
                    <span class="s1">&#39;Payload&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">payload_1</span><span class="p">,</span> <span class="n">payload_2</span><span class="p">,</span> <span class="n">payload_3</span><span class="p">,</span> <span class="n">payload_4</span><span class="p">],</span> <span class="s1">&#39;lbm&#39;</span>
                <span class="p">)</span>
                <span class="n">payload_range_data</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="s1">&#39;Fuel&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">fuel_1</span><span class="p">,</span> <span class="n">fuel_2</span><span class="p">,</span> <span class="n">fuel_3</span><span class="p">,</span> <span class="n">fuel_4</span><span class="p">],</span> <span class="s1">&#39;lbm&#39;</span><span class="p">)</span>
                <span class="n">payload_range_data</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="s1">&#39;Range&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">range_1</span><span class="p">,</span> <span class="n">range_2</span><span class="p">,</span> <span class="n">range_3</span><span class="p">,</span> <span class="n">range_4</span><span class="p">],</span> <span class="s1">&#39;NM&#39;</span><span class="p">)</span>

                <span class="n">write_data_file</span><span class="p">(</span>
                    <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_reports_dir</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span> <span class="o">/</span> <span class="s1">&#39;payload_range_data.csv&#39;</span><span class="p">,</span>
                    <span class="n">payload_range_data</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Prints the payload/range data to the console if verbosity is set to VERBOSE or DEBUG</span>
                <span class="k">if</span> <span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="n">Verbosity</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">payload_range_data</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">): </span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="k">return</span> <span class="p">(</span><span class="n">economic_range_prob</span><span class="p">,</span> <span class="n">ferry_range_prob</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s1">&#39;One or both of the fallout missions did not run successfully; payload/range &#39;</span>
                    <span class="s1">&#39;diagram was not generated.&#39;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s1">&#39;Payload/range analysis is currently only supported for the energy equations of &#39;</span>
                <span class="s1">&#39;motion.&#39;</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="AviaryProblem.save_results">
<a class="viewcode-back" href="../../../_srcdocs/packages/interface/methods_for_level2.html#aviary.interface.methods_for_level2.AviaryProblem.save_results">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">json_filename</span><span class="o">=</span><span class="s1">&#39;sizing_results.json&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function saves an aviary problem object into a json file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        aviary_problem : AviaryProblem</span>
<span class="sd">            Aviary problem object optimized for the aircraft design/sizing mission.</span>
<span class="sd">            Assumed to contain aviary_inputs and Mission.Summary.GROSS_MASS</span>
<span class="sd">        json_filename : string</span>
<span class="sd">            User specified name and relative path of json file to save the data into.</span>
<span class="sd">        save_to_reports : bool</span>
<span class="sd">            Flag that sets where the results are saved - if True, the file is saved in the OpenMDAO</span>
<span class="sd">            reports directory. If False, the file is saved to the current working directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">aviary_input_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">jsonfile</span><span class="p">:</span>
            <span class="c1"># Loop through aviary input datastructure and create a list</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">aviary_inputs</span><span class="p">:</span>
                <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">units</span><span class="p">))</span> <span class="o">=</span> <span class="n">data</span>
                <span class="n">type_value</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

                <span class="c1"># Get the gross mass value from the sizing problem and add it to input list</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">Mission</span><span class="o">.</span><span class="n">Summary</span><span class="o">.</span><span class="n">GROSS_MASS</span> <span class="ow">or</span> <span class="n">name</span> <span class="o">==</span> <span class="n">Mission</span><span class="o">.</span><span class="n">Design</span><span class="o">.</span><span class="n">GROSS_MASS</span><span class="p">:</span>
                    <span class="n">Mission_Summary_GROSS_MASS_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span>
                        <span class="n">Mission</span><span class="o">.</span><span class="n">Summary</span><span class="o">.</span><span class="n">GROSS_MASS</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">units</span>
                    <span class="p">)</span>
                    <span class="n">Mission_Summary_GROSS_MASS_val_list</span> <span class="o">=</span> <span class="n">Mission_Summary_GROSS_MASS_val</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">Mission_Summary_GROSS_MASS_val_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># there are different data types we need to handle for conversion to json format</span>
                    <span class="c1"># int, bool, float doesn&#39;t need anything special</span>

                    <span class="c1"># Convert numpy arrays to lists</span>
                    <span class="k">if</span> <span class="n">type_value</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

                    <span class="c1"># Lists are fine except if they contain enums or Paths</span>
                    <span class="k">if</span> <span class="n">type_value</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Enum</span><span class="p">):</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)):</span>
                                <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
                        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Path</span><span class="p">):</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)):</span>
                                <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                    <span class="c1"># Enums and Paths need converting to a string</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">name</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

                <span class="c1"># Append the data to the list</span>
                <span class="n">aviary_input_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">type_value</span><span class="p">)])</span>

            <span class="k">if</span> <span class="n">Mission</span><span class="o">.</span><span class="n">Design</span><span class="o">.</span><span class="n">GROSS_MASS</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">aviary_inputs</span><span class="p">:</span>
                <span class="n">aviary_input_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">Mission</span><span class="o">.</span><span class="n">Design</span><span class="o">.</span><span class="n">GROSS_MASS</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Mission</span><span class="o">.</span><span class="n">Design</span><span class="o">.</span><span class="n">GROSS_MASS</span><span class="p">,</span> <span class="s1">&#39;lbm&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="s1">&#39;lbm&#39;</span><span class="p">,</span>
                        <span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span>
                    <span class="p">]</span>
                <span class="p">)</span>

            <span class="c1"># Write the list to a json file</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
                <span class="n">aviary_input_list</span><span class="p">,</span>
                <span class="n">jsonfile</span><span class="p">,</span>
                <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">jsonfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_add_hybrid_objective</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phase_info</span><span class="p">):</span>
        <span class="n">phases</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">phase_info</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">takeoff_mass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">aviary_inputs</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Mission</span><span class="o">.</span><span class="n">Design</span><span class="o">.</span><span class="n">GROSS_MASS</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;lbm&#39;</span><span class="p">)</span>

        <span class="n">obj_comp</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">ExecComp</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;obj = -final_mass / </span><span class="si">{</span><span class="n">takeoff_mass</span><span class="si">}</span><span class="s1"> + final_time / 5.&#39;</span><span class="p">,</span>
            <span class="n">final_mass</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;lbm&#39;</span><span class="p">},</span>
            <span class="n">final_time</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;h&#39;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="s1">&#39;obj_comp&#39;</span><span class="p">,</span> <span class="n">obj_comp</span><span class="p">)</span>

        <span class="n">final_phase_name</span> <span class="o">=</span> <span class="n">phases</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;traj.</span><span class="si">{</span><span class="n">final_phase_name</span><span class="si">}</span><span class="s1">.timeseries.mass&#39;</span><span class="p">,</span>
            <span class="s1">&#39;obj_comp.final_mass&#39;</span><span class="p">,</span>
            <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;traj.</span><span class="si">{</span><span class="n">final_phase_name</span><span class="si">}</span><span class="s1">.timeseries.time&#39;</span><span class="p">,</span>
            <span class="s1">&#39;obj_comp.final_time&#39;</span><span class="p">,</span>
            <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_save_to_csv_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">]</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="o">=</span><span class="n">fieldnames</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value_units</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">aviary_inputs</span><span class="p">):</span>
                <span class="n">value</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="n">value_units</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="n">units</span><span class="p">})</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_read_sizing_json</span><span class="p">(</span><span class="n">json_filename</span><span class="p">,</span> <span class="n">meta_data</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="n">Verbosity</span><span class="o">.</span><span class="n">BRIEF</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function reads in saved results from a json file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    json_filename: str, Path</span>
<span class="sd">        json file to load the data from</span>
<span class="sd">    meta_data: dict</span>
<span class="sd">        Variable metadata that will be used to load file data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    AviaryValues object with updated input values from json file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">aviary_inputs</span> <span class="o">=</span> <span class="n">AviaryValues</span><span class="p">()</span>

    <span class="c1"># load saved input list from json file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_data_file</span><span class="p">:</span>
        <span class="n">loaded_aviary_input_list</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_data_file</span><span class="p">)</span>
        <span class="n">json_data_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># Loop over input list and assign aviary problem input values</span>
    <span class="k">for</span> <span class="n">inputs</span> <span class="ow">in</span> <span class="n">loaded_aviary_input_list</span><span class="p">:</span>
        <span class="p">[</span><span class="n">var_name</span><span class="p">,</span> <span class="n">var_values</span><span class="p">,</span> <span class="n">var_units</span><span class="p">,</span> <span class="n">var_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">inputs</span>

        <span class="c1"># Initialize some flags to identify enums</span>
        <span class="n">is_enum</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">var_type</span> <span class="o">==</span> <span class="s2">&quot;&lt;class &#39;list&#39;&gt;&quot;</span><span class="p">:</span>
            <span class="c1"># check if the list contains enums</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">var_values</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var_values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">var_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="c1"># Found a list of enums: set the flag</span>
                        <span class="n">is_enum</span> <span class="o">=</span> <span class="kc">True</span>

                        <span class="c1"># Manipulate the string to find the value</span>
                        <span class="n">tmp_var_values</span> <span class="o">=</span> <span class="n">var_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">var_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">tmp_var_values</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                        <span class="p">)</span>

            <span class="k">if</span> <span class="n">is_enum</span><span class="p">:</span>
                <span class="n">var_values</span> <span class="o">=</span> <span class="n">convert_strings_to_data</span><span class="p">(</span><span class="n">var_values</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">var_type</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&lt;enum&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Identify enums and manipulate the string to find the value</span>
            <span class="n">tmp_var_values</span> <span class="o">=</span> <span class="n">var_values</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">var_values</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">tmp_var_values</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">var_values</span> <span class="o">=</span> <span class="n">convert_strings_to_data</span><span class="p">([</span><span class="n">var_values</span><span class="p">])</span>

        <span class="c1"># Check if the variable is in meta data</span>
        <span class="k">if</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">meta_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">aviary_inputs</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="n">var_values</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">var_units</span><span class="p">,</span> <span class="n">meta_data</span><span class="o">=</span><span class="n">meta_data</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="n">Verbosity</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;Could not add item in json output to AviaryValues: input string = &#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">inputs</span><span class="si">}</span><span class="s1">, attempted to set_value(</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">var_values</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">var_units</span><span class="si">}</span><span class="s1">). &#39;</span>
                        <span class="s1">&#39;This variable was skipped.&#39;</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Not in the MetaData</span>
            <span class="k">if</span> <span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="n">Verbosity</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;While reading json output, item was not found in MetaData: </span><span class="si">{</span><span class="n">inputs</span><span class="si">}</span><span class="s1">. This &#39;</span>
                    <span class="s1">&#39;variable was skipped.&#39;</span>
                <span class="p">)</span>

    <span class="k">return</span> <span class="n">aviary_inputs</span>


<div class="viewcode-block" id="reload_aviary_problem">
<a class="viewcode-back" href="../../../_srcdocs/packages/interface/methods_for_level2.html#aviary.interface.methods_for_level2.reload_aviary_problem">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">reload_aviary_problem</span><span class="p">(</span>
    <span class="n">filename</span><span class="p">,</span> <span class="n">phase_info</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">BaseMetaData</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">verbosity</span><span class="o">=</span><span class="n">Verbosity</span><span class="o">.</span><span class="n">QUIET</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Loads a previously sized Aviary model and returns an AviaryProblem for that model.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str, Path</span>
<span class="sd">        User specified name and relative path of json file containing the sized aircraft data</span>

<span class="sd">    metadata : dict (optional)</span>
<span class="sd">        Custom metadata if needed to read all variables present in the json output file</span>

<span class="sd">    verbosity : Verbosity, int (optional)</span>
<span class="sd">        Controls level of terminal output for function call</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Aviary Problem object with filled aviary_inputs. To use this problem for anything other than</span>
<span class="sd">    running off-design missions, then the full level 2 interface should be used. &quot;load_inputs()&quot;</span>
<span class="sd">    can be skipped as the &quot;aviary_inputs&quot; attribute is prefilled here.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># warning if default is used</span>
    <span class="c1"># Initialize a new aviary problem and aviary_input data structure</span>
    <span class="n">prob</span> <span class="o">=</span> <span class="n">AviaryProblem</span><span class="p">()</span>

    <span class="n">filename</span> <span class="o">=</span> <span class="n">get_path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="n">aviary_inputs</span> <span class="o">=</span> <span class="n">_read_sizing_json</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">verbosity</span><span class="p">)</span>

    <span class="n">prob</span><span class="o">.</span><span class="n">load_inputs</span><span class="p">(</span><span class="n">aviary_inputs</span><span class="p">,</span> <span class="n">phase_info</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>

    <span class="n">prob</span><span class="o">.</span><span class="n">check_and_preprocess_inputs</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>

    <span class="c1"># Add Systems</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">add_pre_mission_systems</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>

    <span class="n">prob</span><span class="o">.</span><span class="n">add_phases</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>

    <span class="n">prob</span><span class="o">.</span><span class="n">add_post_mission_systems</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>

    <span class="c1"># Link phases and variables</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">link_phases</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>

    <span class="n">prob</span><span class="o">.</span><span class="n">add_driver</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>

    <span class="n">prob</span><span class="o">.</span><span class="n">add_design_variables</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>

    <span class="c1"># Load optimization problem formulation</span>
    <span class="c1"># Detail which variables the optimizer can control</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>

    <span class="n">prob</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>

    <span class="n">prob</span><span class="o">.</span><span class="n">final_setup</span><span class="p">()</span>

    <span class="c1"># some variables are normally in the problem instead, so add them there too</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span>
        <span class="n">Mission</span><span class="o">.</span><span class="n">Summary</span><span class="o">.</span><span class="n">GROSS_MASS</span><span class="p">,</span> <span class="n">aviary_inputs</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="n">Mission</span><span class="o">.</span><span class="n">Summary</span><span class="o">.</span><span class="n">GROSS_MASS</span><span class="p">,</span> <span class="s1">&#39;lbm&#39;</span><span class="p">),</span> <span class="s1">&#39;lbm&#39;</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">prob</span></div>

</pre></div>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Aviary team at NASA
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      Â© Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>